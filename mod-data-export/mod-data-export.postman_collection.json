{
	"info": {
		"_postman_id": "2367d164-fcdb-4c82-8fff-f67c62aacfd0",
		"name": "mod-data-export",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Test setup",
			"item": [
				{
					"name": "Create tenant and enable modules",
					"item": [
						{
							"name": "Login by existing admin",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "b754dabe-c739-495c-bd82-41a68372189d",
										"exec": [
											"pm.test(\"Status code is 201\", function () {",
											"    pm.response.to.have.status(201);",
											"});",
											"",
											"pm.environment.set(\"xokapitoken-admin\", postman.getResponseHeader(\"x-okapi-token\"));"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "3fde075b-cb2e-4e40-a0dd-a46a1dc1d753",
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "x-okapi-tenant",
										"value": "{{xokapitenant}}"
									},
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{  \r\n   \"username\":\"{{username}}\",\r\n   \"password\":\"{{password}}\"\r\n}"
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/authn/login",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"authn",
										"login"
									]
								}
							},
							"response": []
						},
						{
							"name": "Create new tenant",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"id": "462fd13b-76b4-43ce-9a07-008d9641454c",
										"exec": [
											"pm.test(\"Preparing request to create test tenant. Tenant creation might take up to 1 minute...\", () => {",
											"    pm.variables.set(\"tenantData\", JSON.stringify(globals.testData.tenant));",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"id": "6f6cc795-6084-4e3a-94b8-1816b403d108",
										"exec": [
											"// In case the tenant was not created no sense to run further requests\r",
											"postman.setNextRequest(null);\r",
											"\r",
											"pm.test(\"Tenant created - created (201) or already exists (400 with Duplicate tenant id error)\", () => {\r",
											"    pm.expect(pm.response.code).be.oneOf([201, 400]);\r",
											"    if (pm.response.code === 400) {\r",
											"        pm.expect(pm.response.text()).to.include(\"Duplicate tenant id\");\r",
											"        purgeModulesData();\r",
											"    } else {\r",
											"        // All is okay, running further requests\r",
											"        postman.setNextRequest();\r",
											"    }\r",
											"});\r",
											"\r",
											"function purgeModulesData() {\r",
											"    let utils = eval(globals.loadUtils);\r",
											"    let tenantBaseUrl = utils.buildOkapiURL(\"/_/proxy/tenants/\" + pm.variables.get(\"testTenant\"));\r",
											"    pm.sendRequest(tenantBaseUrl + \"/modules\", (err, res) => {\r",
											"        let modulesToDisable = null;\r",
											"        pm.test(\"Preparing request to disable modules if any installed before...\", () => {\r",
											"            pm.expect(err).to.equal(null);\r",
											"            pm.expect(res.code).to.equal(200);\r",
											"\r",
											"            modulesToDisable = res.json();\r",
											"            modulesToDisable.forEach(entry => entry.action = \"disable\");\r",
											"            console.log(modulesToDisable);\r",
											"        });\r",
											"\r",
											"        if (modulesToDisable !== null) {\r",
											"            // In case the response indicates that there are some modules are already installed, their data have to be purged first\r",
											"            if (modulesToDisable.length > 0) {\r",
											"                pm.sendRequest({\r",
											"                    url: tenantBaseUrl + \"/install\",\r",
											"                    method: \"POST\",\r",
											"                    header: {\r",
											"                        \"X-Okapi-Token\": pm.environment.get(\"xokapitoken-admin\"),\r",
											"                        \"Content-type\": \"application/json\"\r",
											"                    },\r",
											"                    body: JSON.stringify(modulesToDisable)\r",
											"                }, (error, response) => {\r",
											"                    pm.test(\"Purging the data for '\" + pm.variables.get(\"testTenant\") + \"' tenant\", () => {\r",
											"                        pm.expect(error).to.equal(null);\r",
											"                        pm.expect(response).to.be.ok;\r",
											"                        // All the data have been purged. Now wait for a minute and run next request\r",
											"                        setTimeout(() => postman.setNextRequest(), 61000);\r",
											"                        postman.setNextRequest();\r",
											"                    });\r",
											"                });\r",
											"            } else {\r",
											"                pm.test(\"No modules to purge for '\" + pm.variables.get(\"testTenant\") + \"' tenant\", () => {\r",
											"                    // Run next request\r",
											"                    postman.setNextRequest();\r",
											"                });\r",
											"            }\r",
											"        }\r",
											"    });\r",
											"}"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "x-okapi-token",
										"value": "{{xokapitoken-admin}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{tenantData}}"
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/_/proxy/tenants",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"_",
										"proxy",
										"tenants"
									]
								}
							},
							"response": []
						},
						{
							"name": "Enable modules for new tenant",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"id": "2fc520ab-6a22-492d-a40d-ef46466f70a1",
										"exec": [
											"let utils = eval(globals.loadUtils);\r",
											"\r",
											"utils.getModuleId(\"mod-data-export\", bodyHandler);\r",
											"utils.getModuleId(\"mod-login\", bodyHandler);\r",
											"utils.getModuleId(\"mod-permissions\", bodyHandler);\r",
											"utils.getModuleId(\"mod-inventory-storage\", bodyHandler);\r",
											"\r",
											"var modulesToEnable = [];\r",
											"\r",
											"function bodyHandler(moduleId) {\r",
											"    modulesToEnable.push({\r",
											"        \"id\": moduleId,\r",
											"        \"action\": \"enable\"\r",
											"    });\r",
											"    pm.variables.set(\"modulesToEnable\", JSON.stringify(modulesToEnable));\r",
											"}"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"id": "5ccc4318-649d-4966-9f49-819e5a30f186",
										"exec": [
											"let utils = eval(globals.loadUtils);\r",
											"\r",
											"postman.setNextRequest(null);\r",
											"pm.test(\"Enabled required modules\", function() {\r",
											"    pm.response.to.have.status(200);\r",
											"    pm.response.to.be.withBody;\r",
											"    postman.setNextRequest();\r",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"type": "text",
										"value": "application/json"
									},
									{
										"key": "x-okapi-token",
										"type": "text",
										"value": "{{xokapitoken-admin}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{modulesToEnable}}"
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/_/proxy/tenants/{{testTenant}}/install",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"_",
										"proxy",
										"tenants",
										"{{testTenant}}",
										"install"
									]
								}
							},
							"response": []
						},
						{
							"name": "Create admin user",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"id": "924e4914-15b2-46fa-a6c1-e22c5c365d03",
										"exec": [
											"pm.variables.set(\"userData\", JSON.stringify(globals.testData.users.admin.user));"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"id": "a844e0bd-ac6d-4916-9bb1-d7915030e49a",
										"exec": [
											"// In case the user was not created no sense to run further requests",
											"postman.setNextRequest(null);",
											"",
											"pm.test(\"User created - Expected Created (201)\", () => {",
											"    pm.response.to.have.status(201);",
											"",
											"    // All is okay so running further requests",
											"    postman.setNextRequest();",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "content-type",
										"type": "text",
										"value": "application/json"
									},
									{
										"key": "x-okapi-tenant",
										"type": "text",
										"value": "{{testTenant}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{userData}}"
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/users",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"users"
									]
								}
							},
							"response": []
						},
						{
							"name": "Create credentials for admin user",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "301bdd6b-a035-4fa6-8ee8-ffc3058773c4",
										"exec": [
											"pm.test(globals.testData.users.admin.user.username + \" user's credentials created\", () => pm.response.to.have.status(201));"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "87fe3e19-7f93-4ebd-bda9-b37c6834205d",
										"exec": [
											"pm.variables.set(\"userCreds\", JSON.stringify(globals.testData.users.admin.credentials));"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "content-type",
										"type": "text",
										"value": "application/json"
									},
									{
										"key": "x-okapi-tenant",
										"type": "text",
										"value": "{{testTenant}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{userCreds}}"
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/authn/credentials",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"authn",
										"credentials"
									]
								}
							},
							"response": []
						},
						{
							"name": "Add all permissions to admin",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "8d571f22-1f90-40f3-bbf2-3103a63c2aa8",
										"exec": [
											"pm.test(globals.testData.users.admin.user.username + \" user's permissions created\", () => pm.response.to.have.status(201));"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "937f6d4f-773f-4e99-8835-451e20f71884",
										"exec": [
											"let utils = eval(globals.loadUtils);\r",
											"let pmRq = {\r",
											"    url: utils.buildOkapiURL('/perms/permissions?length=1000&query=(subPermissions=\"\" NOT subPermissions ==/respectAccents []) and (cql.allRecords=1 NOT childOf <>/respectAccents [])'),\r",
											"    method: \"GET\",\r",
											"    header: {\r",
											"        \"X-Okapi-Tenant\": pm.variables.get(\"testTenant\")\r",
											"    }\r",
											"};\r",
											"pm.sendRequest(pmRq, (err, res) => {\r",
											"    let userPermissions = globals.testData.users.admin.permissions;\r",
											"    userPermissions.permissions = res.json().permissions.map(perm => perm.permissionName);\r",
											"    pm.variables.set(\"userPermissions\", JSON.stringify(userPermissions));\r",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"name": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "x-okapi-tenant",
										"type": "text",
										"value": "{{testTenant}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{userPermissions}}"
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/perms/users",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"perms",
										"users"
									]
								}
							},
							"response": []
						},
						{
							"name": "Enable mod-authtoken for new tenant",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"id": "1bb8ed99-0eb4-40f7-ade6-007eecdae68f",
										"exec": [
											"let utils = eval(globals.loadUtils);\r",
											"\r",
											"utils.getModuleId(\"mod-authtoken\", bodyHandler);\r",
											"\r",
											"var modulesToEnable = [];\r",
											"\r",
											"function bodyHandler(moduleId) {\r",
											"    modulesToEnable.push({\r",
											"        \"id\": moduleId,\r",
											"        \"action\": \"enable\"\r",
											"    });\r",
											"    pm.variables.set(\"modulesToEnable\", JSON.stringify(modulesToEnable));\r",
											"}"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"id": "6bd00034-9323-462b-96d6-ff8f3e544aa8",
										"exec": [
											"let utils = eval(globals.loadUtils);",
											"",
											"postman.setNextRequest(null);",
											"pm.test(\"Enabled mod-finance with all dependencies\", function () {",
											"    pm.response.to.have.status(200);",
											"    pm.response.to.be.withBody;",
											"    postman.setNextRequest();",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"type": "text",
										"value": "application/json"
									},
									{
										"key": "x-okapi-token",
										"type": "text",
										"value": "{{xokapitoken-admin}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{modulesToEnable}}"
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/_/proxy/tenants/{{testTenant}}/install",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"_",
										"proxy",
										"tenants",
										"{{testTenant}}",
										"install"
									]
								}
							},
							"response": []
						},
						{
							"name": "Login by new admin",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "45bffbe6-9d22-4701-813e-ef43f4d1a0a8",
										"exec": [
											"// In case the new user cannot be logged in no sense to run further tests",
											"postman.setNextRequest(null);",
											"",
											"pm.test(\"Status code is 201\", function () {",
											"    pm.response.to.have.status(201);",
											"    // All is okay so running further requests",
											"    postman.setNextRequest();",
											"});",
											"",
											"pm.environment.set(\"xokapitoken-testAdmin\", postman.getResponseHeader(\"x-okapi-token\"));"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "bc22f766-de00-4dd1-889b-9151c288de29",
										"exec": [
											"pm.variables.set(\"newUserCreds\", JSON.stringify(globals.testData.users.admin.credentials));"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "x-okapi-tenant",
										"value": "{{testTenant}}"
									},
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{newUserCreds}}"
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/authn/login",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"authn",
										"login"
									]
								}
							},
							"response": []
						}
					],
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "9b37efbd-194e-4afc-a6cc-9cd25e4ef63e",
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"id": "770e1970-0f43-401a-8425-8734a9b30e2b",
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				},
				{
					"name": "Create regular user",
					"item": [
						{
							"name": "Create user",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"id": "21247563-508e-43cc-a02c-34a53ac15ed8",
										"exec": [
											"pm.variables.set(\"userData\", JSON.stringify(globals.testData.users.regular.user));"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"id": "ad77317e-7a99-43f0-aac2-b6a23f8ec3d4",
										"exec": [
											"// In case the user was not created no sense to run further requests\r",
											"postman.setNextRequest(null);\r",
											"\r",
											"pm.test(\"User created - Expected Created (201)\", () => {\r",
											"    pm.response.to.have.status(201);\r",
											"    // All is okay so running further requests\r",
											"    postman.setNextRequest();\r",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "content-type",
										"type": "text",
										"value": "application/json"
									},
									{
										"key": "x-okapi-token",
										"type": "text",
										"value": "{{xokapitoken-testAdmin}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{userData}}"
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/users",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"users"
									]
								}
							},
							"response": []
						},
						{
							"name": "Create credentials for user",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "3c5b4330-758e-44f1-b4e3-cd1bc717c1de",
										"exec": [
											"pm.test(globals.testData.users.regular.user.username + \" user's credentials created\", () => pm.response.to.have.status(201));"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "300b69c0-8afd-44c8-ad52-20748c108a68",
										"exec": [
											"pm.variables.set(\"userCreds\", JSON.stringify(globals.testData.users.regular.credentials));"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "content-type",
										"type": "text",
										"value": "application/json"
									},
									{
										"key": "x-okapi-token",
										"value": "{{xokapitoken-testAdmin}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{userCreds}}"
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/authn/credentials",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"authn",
										"credentials"
									]
								}
							},
							"response": []
						},
						{
							"name": "Add data-export.all permissions to user",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "f27027db-ae13-43f5-bc1d-36b784cc42bf",
										"exec": [
											"pm.test(globals.testData.users.regular.user.username + \" user's permissions created\", () => {\r",
											"    pm.response.to.have.status(201);\r",
											"    pm.environment.set(\"limitedPrivPermId\", pm.response.json().id);\r",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "8fed08ac-3971-4a73-95b9-df3dec3e1275",
										"exec": [
											"pm.variables.set(\"userPermissions\", JSON.stringify(globals.testData.users.regular.permissions));"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "content-type",
										"type": "text",
										"value": "application/json"
									},
									{
										"key": "x-okapi-token",
										"type": "text",
										"value": "{{xokapitoken-testAdmin}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{userPermissions}}"
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/perms/users",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"perms",
										"users"
									]
								}
							},
							"response": []
						},
						{
							"name": "Login by new user",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "c456ad35-48cf-450d-9c9c-d3d33e95ccc5",
										"exec": [
											"// In case the new user cannot be logged in no sense to run further tests\r",
											"postman.setNextRequest(null);\r",
											"\r",
											"pm.test(\"Status code is 201\", function() {\r",
											"    pm.response.to.have.status(201);\r",
											"    // All is okay so running further requests\r",
											"    postman.setNextRequest();\r",
											"});\r",
											"\r",
											"pm.environment.set(\"xokapitoken\", postman.getResponseHeader(\"x-okapi-token\"));"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "e1dca6f8-6810-4dd4-b157-d62ed30b15a2",
										"exec": [
											"pm.variables.set(\"newUserCreds\", JSON.stringify(globals.testData.users.regular.credentials));"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "x-okapi-tenant",
										"value": "{{testTenant}}"
									},
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{newUserCreds}}"
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/authn/login",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"authn",
										"login"
									]
								}
							},
							"response": []
						}
					],
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "7750e609-7f73-44e8-9d2e-8ae7e259954c",
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"id": "9711ba03-e660-43d7-b041-7911e02c39ae",
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				},
				{
					"name": "Post instance to inventory storage",
					"item": [
						{
							"name": "Create instance type",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"id": "f2c0ef03-0d58-48b1-8f0c-c434dd219d30",
										"exec": [
											"let utils = eval(globals.loadUtils);\r",
											"pm.sendRequest(pm.variables.get(\"resourcesUrl\") + \"/mockData/test_instance_type_to_post.json\", function(err, res) {\r",
											"    let instance_type_to_put = JSON.stringify(res.json());\r",
											"    pm.variables.set(\"instanceTypeToPut\", instance_type_to_put);\r",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"id": "d59fc8c8-5452-413b-a3ae-b4ac366e635a",
										"exec": [
											"pm.test(\"Instance type created - Expected Created (201)\", () => {\r",
											"    pm.response.to.have.status(201);\r",
											"    // All is okay so running further requests\r",
											"    if (pm.response.code === 201) {\r",
											"    pm.variables.set(\"instanceTypeId\", pm.response.json().id);\r",
											"        postman.setNextRequest();\r",
											"    } else {\r",
											"       // Failed to create instance type;\r",
											"        postman.setNextRequest(null);\r",
											"    }\r});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "content-type",
										"type": "text",
										"value": "application/json"
									},
									{
										"key": "x-okapi-token",
										"type": "text",
										"value": "{{xokapitoken-testAdmin}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{instanceTypeToPut}}"
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/instance-types",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"instance-types"
									]
								}
							},
							"response": []
						},
						{
							"name": "Create instance",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"id": "5587e1f3-8f32-4548-b6e9-4efa1667f7ce",
										"exec": [
											"let utils = eval(globals.loadUtils);\r",
											"pm.sendRequest(pm.variables.get(\"resourcesUrl\") + \"/mockData/test_instance_to_post.json\", function(err, res) {\r",
											"    let instance_to_put = JSON.stringify(res.json());\r",
											"    pm.variables.set(\"instanceToPut\", instance_to_put);\r",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"id": "11a383e6-8362-47d5-a5e4-70e294a3409d",
										"exec": [
											"pm.test(\"Instance created - Expected Created (201)\", () => {\r",
											"    pm.response.to.have.status(201);\r",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "content-type",
										"type": "text",
										"value": "application/json"
									},
									{
										"key": "x-okapi-token",
										"type": "text",
										"value": "{{xokapitoken-testAdmin}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{instanceToPut}}"
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/instance-storage/instances",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"instance-storage",
										"instances"
									]
								}
							},
							"response": []
						}
					],
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "fc3c7647-816e-4a07-aef8-2a798a06d723",
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"id": "bbc2c661-4087-452c-9cd8-e2d63ff7f462",
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "90506a1b-e82c-4ca7-b10d-95d00bb6b3b0",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "7f5dc9a0-4c0f-43cc-a46c-bd2f98d11a96",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			],
			"protocolProfileBehavior": {}
		},
		{
			"name": "Main tests",
			"item": [
				{
					"name": "Post file definition with invalid filename extension",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "9ba734dd-d337-4b09-9417-b2eb3ff850f1",
								"type": "text/javascript",
								"exec": [
									"let fileName = JSON.stringify(globals.testData.fileDefinitions.invalidFileDefinition.fileName);",
									"pm.test(\"File difinition with fileName \\\"\"+fileName+\"\\\" has been created\", () => {",
									"    pm.response.to.have.status(422);",
									"    pm.response.to.be.withBody;",
									"});"
								]
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "1a0b14e4-d607-4d18-8781-6d8ad2093121",
								"type": "text/javascript",
								"exec": [
									"pm.variables.set(\"fileDefinition\", JSON.stringify(globals.testData.fileDefinitions.invalidFileDefinition));"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "content-type",
								"value": "application/json"
							},
							{
								"key": "x-okapi-token",
								"value": "{{xokapitoken}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{{fileDefinition}}"
						},
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/fileDefinitions",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"data-export",
								"fileDefinitions"
							]
						}
					},
					"response": []
				},
				{
					"name": "Post file definition",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "ff58da62-4aec-441c-b9cd-33487d40356a",
								"type": "text/javascript",
								"exec": [
									"let fileName = JSON.stringify(globals.testData.fileDefinitions.validFileDefinition.fileName);",
									"pm.test(\"File difinition with fileName \\\"\"+fileName+\"\\\" has been created\", () => {",
									"    pm.response.to.have.status(201);",
									"    pm.response.to.be.withBody;",
									"});",
									"",
									"let fileDefinition = pm.response.json();",
									"pm.globals.set(\"fileDefinitionId\", fileDefinition.id);"
								]
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "bb62c90b-b5a7-4cc7-8e9b-1f2ebd5c56c1",
								"type": "text/javascript",
								"exec": [
									"pm.variables.set(\"fileDefinition\", JSON.stringify(globals.testData.fileDefinitions.validFileDefinition));"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "content-type",
								"value": "application/json"
							},
							{
								"key": "x-okapi-token",
								"value": "{{xokapitoken}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{{fileDefinition}}"
						},
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/fileDefinitions",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"data-export",
								"fileDefinitions"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get file definition by id",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "24f4138e-1bd2-4501-8c51-07f4e677b4dc",
								"type": "text/javascript",
								"exec": [
									"let fileName = JSON.stringify(globals.testData.fileDefinitions.validFileDefinition.fileName);",
									"pm.test(\"File definition with fileName \"+fileName+ \" has been retrieved successfully\", () => {",
									"    pm.response.to.have.status(200);",
									"    pm.response.to.be.withBody;",
									"});"
								]
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "95b1e80f-c064-4a31-8340-2ffef15ef056",
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "content-type",
								"value": "application/json"
							},
							{
								"key": "x-okapi-token",
								"value": "{{xokapitoken}}"
							}
						],
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/fileDefinitions/{{fileDefinitionId}}",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"data-export",
								"fileDefinitions",
								"{{fileDefinitionId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Post uploading a file",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "8dd606cf-366a-4361-9b14-b0ec195f4f77",
								"type": "text/javascript",
								"exec": [
									"let fileName = JSON.stringify(globals.testData.fileDefinitions.validFileDefinition.fileName);",
									"pm.test(\"File has been uplouaded sucessfully\", () => {",
									"    pm.response.to.have.status(200);",
									"    pm.response.to.be.withBody;",
									"});",
									"",
									"let fileDefinition = pm.response.json();",
									"",
									"pm.test(\"Directory for uploaded file has been created & source path not empty\", () => {",
									"    pm.expect(fileDefinition.sourcePath).not.equal(null);",
									"})",
									"",
									"pm.test(\"Status has completed value\", () => {",
									"    pm.expect(fileDefinition.status).equal(\"COMPLETED\");",
									"})",
									"",
									"pm.test(\"With metadata\", () => {",
									"    pm.expect(fileDefinition.metadata).not.equal(null);",
									"})",
									"",
									"pm.variables.set(\"jobExecutionId\", fileDefinition.jobExecutionId);"
								]
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "a83942bf-a4c4-45e4-aa57-8fd7426e0807",
								"type": "text/javascript",
								"exec": [
									"let utils = eval(globals.loadUtils);\r",
									"pm.sendRequest(pm.variables.get(\"resourcesUrl\") + \"/mockData/test_file_to_upload.csv\", function(err, res) {\r",
									"    let arr = new Uint8Array(res.stream);\r",
									"    let test_file_to_upload = String.fromCharCode.apply(String, arr);\n\r",
									"    pm.variables.set(\"fileToUpload\", test_file_to_upload);\r",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/octet-stream"
							},
							{
								"key": "x-okapi-token",
								"value": "{{xokapitoken}}"
							},
							{
								"key": "Content-Disposition",
								"value": "attachment"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{{fileToUpload}}"
						},
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/fileDefinitions/{{fileDefinitionId}}/upload",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"data-export",
								"fileDefinitions",
								"{{fileDefinitionId}}",
								"upload"
							]
						}
					},
					"response": []
				},
				{
					"name": "Post uploading a file - Idempotent",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "baee344e-7662-4401-bc4b-69dea9ebb408",
								"exec": [
									"pm.test(\"File is already uploaded\", () => {",
									"    pm.response.to.have.status(400);",
									"    pm.response.to.be.withBody;",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "f8fe483e-ade8-407b-b3de-63a2a0af6299",
								"exec": [
									"let utils = eval(globals.loadUtils);\r",
									"pm.sendRequest(pm.variables.get(\"resourcesUrl\") + \"/mockData/test_file_to_upload.csv\", function(err, res) {\r",
									"    let test_file_to_upload = res.body;\r",
									"    pm.variables.set(\"fileToUpload\", test_file_to_upload);\r",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/octet-stream"
							},
							{
								"key": "x-okapi-token",
								"value": "{{xokapitoken}}"
							},
							{
								"key": "Content-Disposition",
								"value": "attachment"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{{fileToUpload}}"
						},
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/fileDefinitions/{{fileDefinitionId}}/upload",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"data-export",
								"fileDefinitions",
								"{{fileDefinitionId}}",
								"upload"
							]
						}
					},
					"response": []
				},
				{
					"name": "Export uploaded file",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "ff464145-a4d6-4787-a254-3c9283f732de",
								"exec": [
									"pm.test(\"Export of uploaded file completed successfully\", () => {\r",
									"    pm.response.to.have.status(204);\r",
									"    // The export process has begun. Wait 10 seconds for it to complete.\r",
									"    setTimeout(() => postman.setNextRequest(), 10000);\r",
									"});\r"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "a3268d8f-7677-4741-b280-8ce7d406252d",
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "x-okapi-token",
								"type": "text",
								"value": "{{xokapitoken}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"fileDefinitionId\": \"{{fileDefinitionId}}\",\n  \"jobProfileId\": \"da0ccaa8-6f59-11ea-bc55-0242ac130003\",\n  \"metadata\": {\n    \"createdDate\": \"2020-03-21T07:48:51.974+0000\",\n    \"createdByUserId\": \"ee82f536-0498-5c6e-88a2-0e546eea8ad6\",\n    \"updatedDate\": \"2020-03-21T07:48:51.974+0000\",\n    \"updatedByUserId\": \"ee82f536-0498-5c6e-88a2-0e546eea8ad6\"\n  }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/export",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"data-export",
								"export"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get job execution",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "68991362-05a0-4e59-a3d3-3c8f2f75e23d",
								"exec": [
									"pm.test(\"Job execution has been retrieved successfully\", () => {\r",
									"    pm.response.to.have.status(200);\r",
									"    pm.response.to.be.withBody;",
									"});\r",
									"",
									"let jobExecution = pm.response.json().jobExecutions.find(job => job.id === pm.variables.get(\"jobExecutionId\"));",
									"",
									"pm.test(\"The status is success\", () => {",
									"    pm.expect(jobExecution.status).equal(\"SUCCESS\");",
									"});\r",
									"",
									"pm.test(\"File name contains hrId\", () => {",
									"pm.expect(jobExecution.exportedFiles[0].fileName).include(jobExecution.hrId);",
									"});\r",
									"",
									"pm.test(\"With runBy object\", () => {",
									"pm.expect(jobExecution.runBy).not.equal(null);",
									"});\r",
									"",
									"pm.test(\"With progress\", () => {",
									"pm.expect(jobExecution.progress).not.equal(null);",
									"});\r"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "d9c94793-d5a8-48e8-9db6-3b5b80379667",
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "x-okapi-token",
								"type": "text",
								"value": "{{xokapitoken}}"
							}
						],
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/jobExecutions?query=id={{jobExecutionId}}",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"data-export",
								"jobExecutions"
							],
							"query": [
								{
									"key": "query",
									"value": "id={{jobExecutionId}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Post mappingProfile",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "4c621433-3228-4259-8715-4340e3b1bac0",
								"exec": [
									"",
									"pm.test(\"Mapping profile has been created\", () => {",
									"    pm.response.to.have.status(201);",
									"    pm.response.to.be.withBody;",
									"});",
									"",
									"let mappingProfile = pm.response.json();",
									"",
									"pm.test(\"With id\", () => {",
									"    pm.expect(mappingProfile.id).not.equal(null);",
									"});",
									"",
									"pm.test(\"With name\", () => {",
									"    pm.expect(mappingProfile.name).not.equal(null);",
									"});",
									"",
									"pm.test(\"With recordTypes and it equal to instance\", () => {",
									"    pm.expect(mappingProfile.recordTypes[0]).equal(\"INSTANCE\");",
									"});",
									"",
									"pm.test(\"With transformations\", () => {",
									"    pm.expect(mappingProfile.transformations).not.equal(null);",
									"});",
									"",
									"pm.variables.set(\"mappingProfile\", mappingProfile);",
									"pm.variables.set(\"mappingProfileId\", mappingProfile.id);",
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "4f655dd2-47f1-4264-b884-8a261a278bf5",
								"exec": [
									"pm.variables.set(\"mappingProfile\", JSON.stringify(globals.testData.mappingProfile));"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "content-type",
								"value": "application/json"
							},
							{
								"key": "x-okapi-token",
								"value": "{{xokapitoken}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{{mappingProfile}}"
						},
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/mappingProfiles",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"data-export",
								"mappingProfiles"
							]
						}
					},
					"response": []
				},
				{
					"name": "Update mappingProfile",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "2c3b2896-80a9-42ab-801f-ede37fe6b877",
								"exec": [
									"",
									"pm.test(\"Mapping profile has been updated\", () => {",
									"    pm.response.to.have.status(204);",
									"});",
									"",
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "e62fe74f-0206-4a9b-8175-ec1d41bee009",
								"exec": [
									"let mappingProfile = pm.variables.get(\"mappingProfile\");",
									"mappingProfile.recordTypes[0] = \"HOLDINGS\";",
									"pm.variables.set(\"updatedMappingProfile\",  JSON.stringify(mappingProfile));"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "content-type",
								"value": "application/json"
							},
							{
								"key": "x-okapi-token",
								"value": "{{xokapitoken}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{{updatedMappingProfile}}"
						},
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/mappingProfiles/{{mappingProfileId}}",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"data-export",
								"mappingProfiles",
								"{{mappingProfileId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get mapping profile by id",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "44977485-9030-402d-9326-23c9475513f6",
								"exec": [
									"pm.test(\"The mapping profile by id has been retrieved successfully\", () => {\r",
									"    pm.response.to.have.status(200);\r",
									"    pm.response.to.be.withBody;\r",
									"});\r",
									"\r",
									"let mappingProfile = pm.response.json();\r",
									"\r",
									"pm.test(\"With updated recordTypes and it equals to HOLDINGS\", () => {\r",
									"    pm.expect(mappingProfile.recordTypes[0]).equal(\"HOLDINGS\");\r",
									"});\r",
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "ab2373ac-7626-487e-81fc-0919e8e9b551",
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							},
							{
								"key": "x-okapi-token",
								"type": "text",
								"value": "{{xokapitoken}}"
							}
						],
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/mappingProfiles/{{mappingProfileId}}",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"data-export",
								"mappingProfiles",
								"{{mappingProfileId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get mapping profile by query",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "9fd822f7-c523-434c-b85a-5737b21d5561",
								"exec": [
									"pm.test(\"The Mapping profiles by query has been retrieved successfully\", () => {\r",
									"    pm.response.to.have.status(200);\r",
									"    pm.response.to.be.withBody;\r",
									"});\r",
									"\r",
									"let mappingProfileId = pm.variables.get(\"mappingProfileId\");\r",
									"let mappingProfile = pm.response.json().mappingProfiles.find(profile => profile.id === mappingProfileId);\r",
									"let totalRecords = pm.response.json().totalRecords;\r",
									"\r",
									"pm.test(\"With total records equals to  1\", () => {\r",
									"    pm.expect(totalRecords).equal(1);\r",
									"});\r",
									"\r",
									"pm.test(\"With correct id\", () => {\r",
									"    pm.expect(mappingProfile.id).equal(mappingProfileId);\r",
									"});\r",
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "f41c3f00-8b26-475a-bbb8-7752191424db",
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "x-okapi-token",
								"type": "text",
								"value": "{{xokapitoken}}"
							}
						],
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/mappingProfiles?query=id=={{mappingProfileId}}",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"data-export",
								"mappingProfiles"
							],
							"query": [
								{
									"key": "query",
									"value": "id=={{mappingProfileId}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Delete mappingProfile",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "b9a82686-54ca-45eb-8cc3-58c22d4b341e",
								"exec": [
									"",
									"pm.test(\"Mapping profile has been deleted\", () => {",
									"    pm.response.to.have.status(204);",
									"});",
									"",
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "67e3c5f1-ba72-4b8e-abf4-bf9a4f94ddf7",
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "content-type",
								"value": "application/json"
							},
							{
								"key": "x-okapi-token",
								"value": "{{xokapitoken}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{{mappingProfile}}"
						},
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/mappingProfiles/{{mappingProfileId}}",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"data-export",
								"mappingProfiles",
								"{{mappingProfileId}}"
							]
						}
					},
					"response": []
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "f1bce8bf-7b6d-4039-b217-f69752c34939",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "5b57da95-2d7d-41ff-a28e-d4b4d99c2ac7",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			],
			"protocolProfileBehavior": {}
		},
		{
			"name": "Cleanup",
			"item": [
				{
					"name": "clean tenant and modules data",
					"item": [
						{
							"name": "Purge and disable all module for created tenant",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"id": "0f85686b-1a42-43ed-bff9-0374aeac6fdc",
										"exec": [
											"let utils = eval(globals.loadUtils);\r",
											"pm.sendRequest(utils.buildOkapiURL(\"/_/proxy/tenants/\" + pm.variables.get(\"testTenant\") + \"/modules\"), (err, res) => {\r",
											"    pm.test(\"Preparing request to disable modules\", () => {\r",
											"        pm.expect(err).to.equal(null);\r",
											"        pm.expect(res.code).to.equal(200);\r",
											"        let modulesToDisable = res.json();\r",
											"        modulesToDisable.forEach(entry => entry.action = \"disable\");\r",
											"\r",
											"        console.log(modulesToDisable);\r",
											"        pm.variables.set(\"modulesToDisable\", JSON.stringify(modulesToDisable));\r",
											"    });\r",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"id": "cfd33c28-ed14-4ecd-97b9-a0522145ffdc",
										"exec": [
											"let utils = eval(globals.loadUtils);\r",
											"\r",
											"pm.test(\"Disable all modules for test tenant\", function() {\r",
											"    pm.response.to.have.status(200);\r",
											"    pm.response.to.be.withBody;\r",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"type": "text",
										"value": "application/json"
									},
									{
										"key": "X-Okapi-Token",
										"value": "{{xokapitoken-admin}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{modulesToDisable}}"
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/_/proxy/tenants/{{testTenant}}/install?purge=true",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"_",
										"proxy",
										"tenants",
										"{{testTenant}}",
										"install"
									],
									"query": [
										{
											"key": "purge",
											"value": "true"
										}
									]
								}
							},
							"response": []
						},
						{
							"name": "Delete test tenant",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"id": "fa662cca-526f-4b3d-ac4f-2e64b3e5cc00",
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"id": "d9f1ba42-b41c-4002-bda6-d9509072d72e",
										"exec": [
											"pm.test(\"Tenant deleted - Expected Created (204)\", () => {\r",
											"    pm.response.to.have.status(204);\r",
											"});\r",
											"\r",
											"// Remove all created variables\r",
											"eval(globals.loadUtils).unsetTestVariables();"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "DELETE",
								"header": [
									{
										"key": "x-okapi-token",
										"value": "{{xokapitoken-admin}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": ""
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/_/proxy/tenants/{{testTenant}}",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"_",
										"proxy",
										"tenants",
										"{{testTenant}}"
									]
								}
							},
							"response": []
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "8b753936-7dc2-4219-b9ff-9484915f49a5",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "0778f49f-4d0e-48b1-a381-dc0b3d315dcf",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			],
			"protocolProfileBehavior": {}
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"id": "c9d88344-76a9-4db5-8dc2-ac79cc1cddbf",
				"type": "text/javascript",
				"exec": [
					"let testData = {",
					"    // User template with hardcoded id",
					"    users: {",
					"        admin: {",
					"            user: {",
					"                \"id\": \"00000000-1111-5555-9999-999999999999\",",
					"                \"username\": \"mdexp-admin-user\",",
					"                \"active\": true,",
					"                \"personal\": {",
					"                    \"firstName\": \"Test\",",
					"                    \"lastName\": \"Api\"",
					"                }",
					"            },",
					"            credentials: {",
					"                \"username\": \"mdexp-admin-user\",",
					"                \"password\": \"mdexp-admin-password\"",
					"            },",
					"            permissions: {",
					"                \"userId\": \"00000000-1111-5555-9999-999999999999\",",
					"                \"permissions\": []",
					"            }",
					"        },",
					"        regular: {",
					"            user: {",
					"                \"id\": \"00000001-1111-5555-9999-999999999999\",",
					"                \"username\": \"mdexp-user\",",
					"                \"active\": true,",
					"                \"personal\": {",
					"                    \"firstName\": \"Regular\",",
					"                    \"lastName\": \"API Tests\"",
					"                }",
					"            },",
					"            credentials: {",
					"                \"username\": \"mdexp-user\",",
					"                \"password\": \"mdexp-password\"",
					"            },",
					"            permissions: {",
					"                \"userId\": \"00000001-1111-5555-9999-999999999999\",",
					"                \"permissions\": [",
					"                    \"data-export.export.post\",",
					"                    \"data-export.file-definitions.item.get\",",
					"                    \"data-export.file-definitions.item.post\",",
					"                    \"data-export.file-definitions.upload.post\",",
					"                    \"data-export.job-executions.items.get\",",
					"                    \"data-export.mapping-profiles.item.post\",",
					"                    \"data-export.mapping-profiles.collection.get\",",
					"                    \"data-export.mapping-profiles.item.get\",",
					"                    \"data-export.mapping-profiles.item.put\",",
					"                    \"data-export.mapping-profiles.item.delete\"",
					"                ]",
					"            }",
					"        },",
					"    },",
					"    tenant: {",
					"        \"id\": pm.variables.get(\"testTenant\"),",
					"        \"name\": \"Test mod-data-export tenant\",",
					"        \"description\": \"Tenant for test purpose\"",
					"    },",
					"    fileDefinitions: {",
					"        validFileDefinition : {",
					"            \"fileName\": \"test_file.csv\"",
					"        },",
					"        invalidFileDefinition : {",
					"            \"fileName\": \"test_file.txt\"",
					"        }",
					"    },",
					"    mappingProfile: {",
					"      \"id\": \"3798f546-7afb-11ea-bc55-0242ac130003\",",
					"      \"name\": \"Mapping profile\",",
					"      \"description\": \"Mapping profile description\",",
					"      \"recordTypes\": [",
					"        \"INSTANCE\"",
					"      ],",
					"      \"outputFormat\": \"MARC\",",
					"      \"transformations\": [",
					"        {",
					"          \"fieldId\": \"electronicAccess.linkText\",",
					"          \"path\": \"$.electronicAccess[*].linkText\",",
					"          \"transformation\": \"001\",",
					"          \"enabled\": \"true\",",
					"          \"recordType\": \"INSTANCE\"",
					"        }",
					"      ],",
					"      \"userInfo\": {",
					"        \"firstName\": \"User\",",
					"        \"lastName\": \"User\",",
					"        \"userName\": \"@username\"",
					"      },",
					"      \"metadata\": {",
					"        \"createdDate\": \"2019-07-22T11:22:07Z\",",
					"        \"createdByUserId\": \"dee12548-9cee-45fa-bbae-675c1cc0ce3b\",",
					"        \"createdByUsername\": \"janedoeuser\",",
					"        \"updatedDate\": \"2019-07-27T13:28:54Z\",",
					"        \"updatedByUserId\": \"dee12548-9cee-45fa-bbae-675c1cc0ce3b\",",
					"        \"updatedByUsername\": \"\"",
					"      }",
					"    }",
					"};",
					"",
					"// Global testing object - used in further tests",
					"pm.globals.set(\"testData\", testData);",
					"",
					"postman.setGlobalVariable(\"loadUtils\", function loadUtils() {",
					"    let utils = {};",
					"",
					"    utils.buildOkapiURL = function(path) {",
					"        return pm.environment.get(\"protocol\") + \"://\" + pm.environment.get(\"url\") + \":\" + pm.environment.get(\"okapiport\") + path;",
					"    };",
					"",
					"    utils.getModuleId = function(moduleName, bodyHandler) {",
					"        pm.sendRequest({",
					"            url: utils.buildOkapiURL(\"/_/proxy/modules?latest=1&filter=\" + moduleName),",
					"            method: \"GET\",",
					"            header: {",
					"                \"X-Okapi-Token\": pm.environment.get(\"xokapitoken-admin\")",
					"            }",
					"        }, (err, res) => {",
					"            pm.test(moduleName + \" module is available\", () => {",
					"                pm.expect(err).to.equal(null);",
					"                pm.expect(res.code).to.equal(200);",
					"                bodyHandler(res.json()[0].id);",
					"            });",
					"        });",
					"    };",
					"",
					"    /**",
					"     * Clean up variables",
					"     */",
					"    utils.unsetTestVariables = function() {",
					"        pm.globals.unset(\"loadUtils\");",
					"        pm.globals.unset(\"testData\");",
					"        pm.globals.unset(\"fileDefinitionId\");",
					"        pm.environment.unset(\"xokapitoken\");",
					"        pm.environment.unset(\"xokapitoken-admin\");",
					"        pm.environment.unset(\"xokapitoken-testAdmin\");",
					"    };",
					"    return utils;",
					"} + '; loadUtils();');"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"id": "e0e11216-6da5-490c-9d29-530b5759d022",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"id": "ad4728f7-7765-49e8-b42f-b70ac4e9d47d",
			"key": "testTenant",
			"value": "mdexp_test_tenant",
			"type": "string"
		},
		{
			"id": "d0564db6-dc0a-44e8-b1de-2e4be557d30c",
			"key": "xokapitenant",
			"value": "diku",
			"type": "string"
		},
		{
			"id": "ec89f6fd-271b-4f64-89a3-40155d1a2b05",
			"key": "protocol",
			"value": "http",
			"type": "string"
		},
		{
			"id": "af70ea1c-d01f-4da8-99b6-c383d5ba7b6c",
			"key": "url",
			"value": "localhost",
			"type": "string"
		},
		{
			"id": "69720bca-160d-4e11-863f-7bc2d1cf9410",
			"key": "okapiport",
			"value": "9130",
			"type": "string"
		},
		{
			"id": "edc419b2-ea81-4a3c-a9e8-7397ce8f0f55",
			"key": "resourcesUrl",
			"value": "https://raw.githubusercontent.com/folio-org/mod-data-export/master/src/test/resources",
			"type": "string"
		}
	],
	"protocolProfileBehavior": {}
}
