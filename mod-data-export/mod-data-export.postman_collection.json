{
	"info": {
		"_postman_id": "daea873b-cf09-4376-b392-baf8cd689990",
		"name": "mod-data-export",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Test setup",
			"item": [
				{
					"name": "Create tenant and enable modules",
					"item": [
						{
							"name": "Login by existing admin",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "d454f42c-a07d-4fb8-ab40-add6f9b59485",
										"exec": [
											"pm.test(\"Status code is 201\", function () {",
											"    pm.response.to.have.status(201);",
											"});",
											"",
											"pm.environment.set(\"xokapitoken-admin\", postman.getResponseHeader(\"x-okapi-token\"));"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "65e2c51b-d5df-4e37-9408-da1ec43f3197",
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "x-okapi-tenant",
										"value": "{{xokapitenant}}"
									},
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{  \r\n   \"username\":\"{{username}}\",\r\n   \"password\":\"{{password}}\"\r\n}",
									"options": {
										"raw": {}
									}
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/authn/login",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"authn",
										"login"
									]
								}
							},
							"response": []
						},
						{
							"name": "Create new tenant",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"id": "a716f7c1-3b92-4810-807b-02e40c5a524b",
										"exec": [
											"pm.test(\"Preparing request to create test tenant. Tenant creation might take up to 1 minute...\", () => {",
											"    pm.variables.set(\"tenantData\", JSON.stringify(globals.testData.tenant));",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"id": "b50bb845-aebc-4241-b254-069db799d18f",
										"exec": [
											"// In case the tenant was not created no sense to run further requests\r",
											"postman.setNextRequest(null);\r",
											"\r",
											"pm.test(\"Tenant created - created (201) or already exists (400 with Duplicate tenant id error)\", () => {\r",
											"    pm.expect(pm.response.code).be.oneOf([201, 400]);\r",
											"    if (pm.response.code === 400) {\r",
											"        pm.expect(pm.response.text()).to.include(\"Duplicate tenant id\");\r",
											"        purgeModulesData();\r",
											"    } else {\r",
											"        // All is okay, running further requests\r",
											"        postman.setNextRequest();\r",
											"    }\r",
											"});\r",
											"\r",
											"function purgeModulesData() {\r",
											"    let utils = eval(globals.loadUtils);\r",
											"    let tenantBaseUrl = utils.buildOkapiURL(\"/_/proxy/tenants/\" + pm.variables.get(\"testTenant\"));\r",
											"    pm.sendRequest(tenantBaseUrl + \"/modules\", (err, res) => {\r",
											"        let modulesToDisable = null;\r",
											"        pm.test(\"Preparing request to disable modules if any installed before...\", () => {\r",
											"            pm.expect(err).to.equal(null);\r",
											"            pm.expect(res.code).to.equal(200);\r",
											"\r",
											"            modulesToDisable = res.json();\r",
											"            modulesToDisable.forEach(entry => entry.action = \"disable\");\r",
											"            console.log(modulesToDisable);\r",
											"        });\r",
											"\r",
											"        if (modulesToDisable !== null) {\r",
											"            // In case the response indicates that there are some modules are already installed, their data have to be purged first\r",
											"            if (modulesToDisable.length > 0) {\r",
											"                pm.sendRequest({\r",
											"                    url: tenantBaseUrl + \"/install\",\r",
											"                    method: \"POST\",\r",
											"                    header: {\r",
											"                        \"X-Okapi-Token\": pm.environment.get(\"xokapitoken-admin\"),\r",
											"                        \"Content-type\": \"application/json\"\r",
											"                    },\r",
											"                    body: JSON.stringify(modulesToDisable)\r",
											"                }, (error, response) => {\r",
											"                    pm.test(\"Purging the data for '\" + pm.variables.get(\"testTenant\") + \"' tenant\", () => {\r",
											"                        pm.expect(error).to.equal(null);\r",
											"                        pm.expect(response).to.be.ok;\r",
											"                        // All the data have been purged. Now wait for a minute and run next request\r",
											"                        setTimeout(() => postman.setNextRequest(), 61000);\r",
											"                        postman.setNextRequest();\r",
											"                    });\r",
											"                });\r",
											"            } else {\r",
											"                pm.test(\"No modules to purge for '\" + pm.variables.get(\"testTenant\") + \"' tenant\", () => {\r",
											"                    // Run next request\r",
											"                    postman.setNextRequest();\r",
											"                });\r",
											"            }\r",
											"        }\r",
											"    });\r",
											"}"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "x-okapi-token",
										"value": "{{xokapitoken-admin}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{tenantData}}",
									"options": {
										"raw": {}
									}
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/_/proxy/tenants",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"_",
										"proxy",
										"tenants"
									]
								}
							},
							"response": []
						},
						{
							"name": "Enable modules for new tenant",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"id": "f4f8739b-317b-4bd4-8a67-a5e7a9845c68",
										"exec": [
											"let utils = eval(globals.loadUtils);\r",
											"\r",
											"utils.getModuleId(\"mod-data-export\", bodyHandler);\r",
											"utils.getModuleId(\"mod-login\", bodyHandler);\r",
											"utils.getModuleId(\"mod-permissions\", bodyHandler);\r",
											"utils.getModuleId(\"mod-inventory-storage\", bodyHandler);\r",
											"\r",
											"var modulesToEnable = [];\r",
											"\r",
											"function bodyHandler(moduleId) {\r",
											"    modulesToEnable.push({\r",
											"        \"id\": moduleId,\r",
											"        \"action\": \"enable\"\r",
											"    });\r",
											"    pm.variables.set(\"modulesToEnable\", JSON.stringify(modulesToEnable));\r",
											"}"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"id": "0a4db048-faf9-4531-8d18-165bdee0fb3d",
										"exec": [
											"let utils = eval(globals.loadUtils);\r",
											"\r",
											"postman.setNextRequest(null);\r",
											"pm.test(\"Enabled required modules\", function() {\r",
											"    pm.response.to.have.status(200);\r",
											"    pm.response.to.be.withBody;\r",
											"    postman.setNextRequest();\r",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"type": "text",
										"value": "application/json"
									},
									{
										"key": "x-okapi-token",
										"type": "text",
										"value": "{{xokapitoken-admin}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{modulesToEnable}}",
									"options": {
										"raw": {}
									}
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/_/proxy/tenants/{{testTenant}}/install",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"_",
										"proxy",
										"tenants",
										"{{testTenant}}",
										"install"
									]
								}
							},
							"response": []
						},
						{
							"name": "Create admin user",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"id": "19576bd4-44a3-46f2-82ab-fbb27ad0398e",
										"exec": [
											"pm.variables.set(\"userData\", JSON.stringify(globals.testData.users.admin.user));"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"id": "4dda32d7-e5ab-489e-bcdd-dffff2ffbbb4",
										"exec": [
											"// In case the user was not created no sense to run further requests",
											"postman.setNextRequest(null);",
											"",
											"pm.test(\"User created - Expected Created (201)\", () => {",
											"    pm.response.to.have.status(201);",
											"",
											"    // All is okay so running further requests",
											"    postman.setNextRequest();",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "content-type",
										"type": "text",
										"value": "application/json"
									},
									{
										"key": "x-okapi-tenant",
										"type": "text",
										"value": "{{testTenant}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{userData}}",
									"options": {
										"raw": {}
									}
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/users",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"users"
									]
								}
							},
							"response": []
						},
						{
							"name": "Create credentials for admin user",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "71712a72-f232-4cfd-9df9-0a709635b0de",
										"exec": [
											"pm.test(globals.testData.users.admin.user.username + \" user's credentials created\", () => pm.response.to.have.status(201));"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "b34da56e-5035-441b-9b9c-8267a31b4767",
										"exec": [
											"pm.variables.set(\"userCreds\", JSON.stringify(globals.testData.users.admin.credentials));"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "content-type",
										"type": "text",
										"value": "application/json"
									},
									{
										"key": "x-okapi-tenant",
										"type": "text",
										"value": "{{testTenant}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{userCreds}}",
									"options": {
										"raw": {}
									}
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/authn/credentials",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"authn",
										"credentials"
									]
								}
							},
							"response": []
						},
						{
							"name": "Add all permissions to admin",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "21f09e25-0e35-42f8-8222-811c6d7ae43b",
										"exec": [
											"pm.test(globals.testData.users.admin.user.username + \" user's permissions created\", () => pm.response.to.have.status(201));"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "8d01deec-2ec8-49b8-9429-f2cb7eb5115b",
										"exec": [
											"let utils = eval(globals.loadUtils);\r",
											"let pmRq = {\r",
											"    url: utils.buildOkapiURL('/perms/permissions?length=1000&query=(subPermissions=\"\" NOT subPermissions ==/respectAccents []) and (cql.allRecords=1 NOT childOf <>/respectAccents [])'),\r",
											"    method: \"GET\",\r",
											"    header: {\r",
											"        \"X-Okapi-Tenant\": pm.variables.get(\"testTenant\")\r",
											"    }\r",
											"};\r",
											"pm.sendRequest(pmRq, (err, res) => {\r",
											"    let userPermissions = globals.testData.users.admin.permissions;\r",
											"    userPermissions.permissions = res.json().permissions.map(perm => perm.permissionName);\r",
											"    pm.variables.set(\"userPermissions\", JSON.stringify(userPermissions));\r",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"name": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "x-okapi-tenant",
										"type": "text",
										"value": "{{testTenant}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{userPermissions}}",
									"options": {
										"raw": {}
									}
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/perms/users",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"perms",
										"users"
									]
								}
							},
							"response": []
						},
						{
							"name": "Enable mod-authtoken for new tenant",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"id": "11bfd98f-8dba-4fd0-9aa3-7627519bce6f",
										"exec": [
											"let utils = eval(globals.loadUtils);\r",
											"\r",
											"utils.getModuleId(\"mod-authtoken\", bodyHandler);\r",
											"\r",
											"var modulesToEnable = [];\r",
											"\r",
											"function bodyHandler(moduleId) {\r",
											"    modulesToEnable.push({\r",
											"        \"id\": moduleId,\r",
											"        \"action\": \"enable\"\r",
											"    });\r",
											"    pm.variables.set(\"modulesToEnable\", JSON.stringify(modulesToEnable));\r",
											"}"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"id": "086a52ff-b15a-4890-ac45-e1a5987b78b6",
										"exec": [
											"let utils = eval(globals.loadUtils);",
											"",
											"postman.setNextRequest(null);",
											"pm.test(\"Enabled mod-finance with all dependencies\", function () {",
											"    pm.response.to.have.status(200);",
											"    pm.response.to.be.withBody;",
											"    postman.setNextRequest();",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"type": "text",
										"value": "application/json"
									},
									{
										"key": "x-okapi-token",
										"type": "text",
										"value": "{{xokapitoken-admin}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{modulesToEnable}}",
									"options": {
										"raw": {}
									}
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/_/proxy/tenants/{{testTenant}}/install",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"_",
										"proxy",
										"tenants",
										"{{testTenant}}",
										"install"
									]
								}
							},
							"response": []
						},
						{
							"name": "Login by new admin",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "8c127325-3be0-423b-a0b6-9b4b37a72f7a",
										"exec": [
											"// In case the new user cannot be logged in no sense to run further tests",
											"postman.setNextRequest(null);",
											"",
											"pm.test(\"Status code is 201\", function () {",
											"    pm.response.to.have.status(201);",
											"    // All is okay so running further requests",
											"    postman.setNextRequest();",
											"});",
											"",
											"pm.environment.set(\"xokapitoken-testAdmin\", postman.getResponseHeader(\"x-okapi-token\"));"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "3a23c7a9-8eac-44d8-87f5-da89c0cacef3",
										"exec": [
											"pm.variables.set(\"newUserCreds\", JSON.stringify(globals.testData.users.admin.credentials));"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "x-okapi-tenant",
										"value": "{{testTenant}}"
									},
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{newUserCreds}}",
									"options": {
										"raw": {}
									}
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/authn/login",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"authn",
										"login"
									]
								}
							},
							"response": []
						}
					],
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "48256ee6-1d60-48ec-a1b2-1f5840e033ee",
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"id": "5aa908b2-2283-44ce-94fc-a440a065dd53",
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				},
				{
					"name": "Create regular user",
					"item": [
						{
							"name": "Create user",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"id": "0ebbcfd7-4efa-4c41-b925-c4918b8e01a9",
										"exec": [
											"pm.variables.set(\"userData\", JSON.stringify(globals.testData.users.regular.user));"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"id": "2aaa4151-c93d-4db7-b1f1-4781a07027a5",
										"exec": [
											"// In case the user was not created no sense to run further requests\r",
											"postman.setNextRequest(null);\r",
											"\r",
											"pm.test(\"User created - Expected Created (201)\", () => {\r",
											"    pm.response.to.have.status(201);\r",
											"    // All is okay so running further requests\r",
											"    postman.setNextRequest();\r",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "content-type",
										"type": "text",
										"value": "application/json"
									},
									{
										"key": "x-okapi-token",
										"type": "text",
										"value": "{{xokapitoken-testAdmin}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{userData}}",
									"options": {
										"raw": {}
									}
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/users",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"users"
									]
								}
							},
							"response": []
						},
						{
							"name": "Create credentials for user",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "ed0b56bd-c8a8-489d-872b-42ce37eff6c1",
										"exec": [
											"pm.test(globals.testData.users.regular.user.username + \" user's credentials created\", () => pm.response.to.have.status(201));"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "ff7833bb-3630-49e2-81f8-a74b2b09944c",
										"exec": [
											"pm.variables.set(\"userCreds\", JSON.stringify(globals.testData.users.regular.credentials));"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "content-type",
										"type": "text",
										"value": "application/json"
									},
									{
										"key": "x-okapi-token",
										"value": "{{xokapitoken-testAdmin}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{userCreds}}",
									"options": {
										"raw": {}
									}
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/authn/credentials",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"authn",
										"credentials"
									]
								}
							},
							"response": []
						},
						{
							"name": "Add data-export.all permissions to user",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "5c22dc62-d9bc-4750-b245-3b15e42be381",
										"exec": [
											"pm.test(globals.testData.users.regular.user.username + \" user's permissions created\", () => {\r",
											"    pm.response.to.have.status(201);\r",
											"    pm.environment.set(\"limitedPrivPermId\", pm.response.json().id);\r",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "4e782362-c8f9-449c-bb5c-38b7fdc36460",
										"exec": [
											"pm.variables.set(\"userPermissions\", JSON.stringify(globals.testData.users.regular.permissions));"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "content-type",
										"type": "text",
										"value": "application/json"
									},
									{
										"key": "x-okapi-token",
										"type": "text",
										"value": "{{xokapitoken-testAdmin}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{userPermissions}}",
									"options": {
										"raw": {}
									}
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/perms/users",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"perms",
										"users"
									]
								}
							},
							"response": []
						},
						{
							"name": "Login by new user",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "599c0695-18b2-4be8-b943-0510bb268f76",
										"exec": [
											"// In case the new user cannot be logged in no sense to run further tests\r",
											"postman.setNextRequest(null);\r",
											"\r",
											"pm.test(\"Status code is 201\", function() {\r",
											"    pm.response.to.have.status(201);\r",
											"    // All is okay so running further requests\r",
											"    postman.setNextRequest();\r",
											"});\r",
											"\r",
											"pm.environment.set(\"xokapitoken\", postman.getResponseHeader(\"x-okapi-token\"));"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "f53dc4d4-eef3-4303-b765-62d46f6d7d28",
										"exec": [
											"pm.variables.set(\"newUserCreds\", JSON.stringify(globals.testData.users.regular.credentials));"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "x-okapi-tenant",
										"value": "{{testTenant}}"
									},
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{newUserCreds}}",
									"options": {
										"raw": {}
									}
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/authn/login",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"authn",
										"login"
									]
								}
							},
							"response": []
						}
					],
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "a3663392-b41e-46d8-8b60-c95cf6468a7d",
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"id": "0fb53fd4-f1fd-4f67-b8fd-7f1631373d24",
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				},
				{
					"name": "Post instance to inventory storage",
					"item": [
						{
							"name": "Create instance type",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"id": "6cb73db7-4dc3-42e9-8063-696c9534352c",
										"exec": [
											"let utils = eval(globals.loadUtils);\r",
											"pm.sendRequest(pm.variables.get(\"resourcesUrl\") + \"/mockData/test_instance_type_to_post.json\", function(err, res) {\r",
											"    let instance_type_to_put = JSON.stringify(res.json());\r",
											"    pm.variables.set(\"instanceTypeToPut\", instance_type_to_put);\r",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"id": "9f9890f6-5563-4e42-99c7-948d81749110",
										"exec": [
											"pm.test(\"Instance type created - Expected Created (201)\", () => {\r",
											"    pm.response.to.have.status(201);\r",
											"    // All is okay so running further requests\r",
											"    if (pm.response.code === 201) {\r",
											"    pm.variables.set(\"instanceTypeId\", pm.response.json().id);\r",
											"        postman.setNextRequest();\r",
											"    } else {\r",
											"       // Failed to create instance type;\r",
											"        postman.setNextRequest(null);\r",
											"    }\r});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "content-type",
										"type": "text",
										"value": "application/json"
									},
									{
										"key": "x-okapi-token",
										"type": "text",
										"value": "{{xokapitoken-testAdmin}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{instanceTypeToPut}}",
									"options": {
										"raw": {}
									}
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/instance-types",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"instance-types"
									]
								}
							},
							"response": []
						},
						{
							"name": "Create instance",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"id": "ed3b2c9d-f2a4-476c-beaf-39ef2082734e",
										"exec": [
											"let utils = eval(globals.loadUtils);\r",
											"pm.sendRequest(pm.variables.get(\"resourcesUrl\") + \"/mockData/test_instance_to_post.json\", function(err, res) {\r",
											"    let instance_to_put = JSON.stringify(res.json());\r",
											"    pm.variables.set(\"instanceToPut\", instance_to_put);\r",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"id": "8183b86a-109f-45a3-a95f-1bb5bd5c1d2b",
										"exec": [
											"pm.test(\"Instance created - Expected Created (201)\", () => {\r",
											"    pm.response.to.have.status(201);\r",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "content-type",
										"type": "text",
										"value": "application/json"
									},
									{
										"key": "x-okapi-token",
										"type": "text",
										"value": "{{xokapitoken-testAdmin}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{instanceToPut}}",
									"options": {
										"raw": {}
									}
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/instance-storage/instances",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"instance-storage",
										"instances"
									]
								}
							},
							"response": []
						}
					],
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "9dfeb6f1-b08c-4ae8-ad2c-712a88675a02",
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"id": "7bf0d3af-e8c3-4005-8d88-36f3dd3338e8",
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "5b80cf09-8eaf-4a03-bb60-b43311b1c032",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "9cdd8e70-962b-48e4-a285-b48a8a7df67e",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			],
			"protocolProfileBehavior": {}
		},
		{
			"name": "Main tests",
			"item": [
				{
					"name": "Profiles",
					"item": [
						{
							"name": "Post mappingProfile",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "cc308480-abb4-40a5-8075-ba3379e19068",
										"exec": [
											"pm.test(\"Mapping profile has been created\", () => {",
											"    pm.response.to.have.status(201);",
											"    pm.response.to.be.withBody;",
											"});",
											"",
											"let regularUser = globals.testData.users.regular.user;",
											"let mappingProfile = pm.response.json();",
											"",
											"pm.test(\"With id\", () => {",
											"    pm.expect(mappingProfile.id).not.equal(null);",
											"});",
											"",
											"pm.test(\"With name\", () => {",
											"    pm.expect(mappingProfile.name).not.equal(null);",
											"});",
											"",
											"pm.test(\"With recordTypes and it equal to holdings and item\", () => {",
											"    pm.expect(mappingProfile.recordTypes[0]).equal(\"INSTANCE\");",
											"    pm.expect(mappingProfile.recordTypes[1]).equal(\"HOLDINGS\");",
											"    pm.expect(mappingProfile.recordTypes[2]).equal(\"ITEM\");",
											"});",
											"",
											"pm.test(\"With transformations\", () => {",
											"    pm.expect(mappingProfile.transformations).not.equal(null);",
											"});",
											"",
											"pm.test(\"With userInfo exist\", () => {",
											"    pm.expect(mappingProfile.userInfo).not.equal(null);",
											"});",
											"",
											"pm.test(\"With valid firstName\", () => {",
											"    pm.expect(mappingProfile.userInfo.firstName).equal(regularUser.personal.firstName);",
											"});",
											"",
											"pm.test(\"With valid lastName\", () => {",
											"    pm.expect(mappingProfile.userInfo.lastName).equal(regularUser.personal.lastName);",
											"});",
											"",
											"pm.test(\"With valid userName\", () => {",
											"    pm.expect(mappingProfile.userInfo.userName).equal(regularUser.username);",
											"});",
											"",
											"pm.variables.set(\"mappingProfile\", mappingProfile);",
											"pm.environment.set(\"mappingProfileId\", mappingProfile.id);",
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "87f00d29-31b1-4bae-807f-b5a25ac35f05",
										"exec": [
											"pm.variables.set(\"mappingProfile\", JSON.stringify(globals.testData.mappingProfile));\r",
											""
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "content-type",
										"value": "application/json"
									},
									{
										"key": "x-okapi-token",
										"value": "{{xokapitoken}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{mappingProfile}}"
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/mapping-profiles",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"data-export",
										"mapping-profiles"
									]
								}
							},
							"response": []
						},
						{
							"name": "Update mappingProfile",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "ded6f65a-689e-45a7-8853-f1104ef03ddd",
										"exec": [
											"",
											"pm.test(\"Mapping profile has been updated\", () => {",
											"    pm.response.to.have.status(204);",
											"});",
											"",
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "fb104451-9501-475d-9754-356fccbd847d",
										"exec": [
											"let mappingProfile = pm.variables.get(\"mappingProfile\");",
											"mappingProfile.recordTypes[0] = \"HOLDINGS\";",
											"pm.variables.set(\"updatedMappingProfile\",  JSON.stringify(mappingProfile));"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "PUT",
								"header": [
									{
										"key": "content-type",
										"value": "application/json"
									},
									{
										"key": "x-okapi-token",
										"value": "{{xokapitoken}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{updatedMappingProfile}}"
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/mapping-profiles/{{mappingProfileId}}",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"data-export",
										"mapping-profiles",
										"{{mappingProfileId}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Get mapping profile by id",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "59656992-e5de-4c27-aeb3-27bb20c3d869",
										"exec": [
											"pm.test(\"The mapping profile by id has been retrieved successfully\", () => {\r",
											"    pm.response.to.have.status(200);\r",
											"    pm.response.to.be.withBody;\r",
											"});\r",
											"\r",
											"let mappingProfile = pm.response.json();\r",
											"\r",
											"pm.test(\"With updated recordTypes and it equals to HOLDINGS\", () => {\r",
											"    pm.expect(mappingProfile.recordTypes[0]).equal(\"HOLDINGS\");\r",
											"});\r",
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "fe74d174-6676-4ae8-b1cc-95be620df799",
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"name": "Content-Type",
										"type": "text",
										"value": "application/json"
									},
									{
										"key": "x-okapi-token",
										"type": "text",
										"value": "{{xokapitoken}}"
									}
								],
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/mapping-profiles/{{mappingProfileId}}",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"data-export",
										"mapping-profiles",
										"{{mappingProfileId}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Get mapping profile by query",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "278bcb30-335b-43fc-a337-177647bee395",
										"exec": [
											"pm.test(\"The Mapping profiles by query has been retrieved successfully\", () => {\r",
											"    pm.response.to.have.status(200);\r",
											"    pm.response.to.be.withBody;\r",
											"});\r",
											"\r",
											"let mappingProfileId = pm.variables.get(\"mappingProfileId\");\r",
											"let mappingProfile = pm.response.json().mappingProfiles.find(profile => profile.id === mappingProfileId);\r",
											"let totalRecords = pm.response.json().totalRecords;\r",
											"\r",
											"pm.test(\"With total records equals to  1\", () => {\r",
											"    pm.expect(totalRecords).equal(1);\r",
											"});\r",
											"\r",
											"pm.test(\"With correct id\", () => {\r",
											"    pm.expect(mappingProfile.id).equal(mappingProfileId);\r",
											"});\r",
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "23d29aee-c892-406d-b7a9-27a7cb413811",
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"name": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "x-okapi-token",
										"type": "text",
										"value": "{{xokapitoken}}"
									}
								],
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/mapping-profiles?query=id=={{mappingProfileId}}",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"data-export",
										"mapping-profiles"
									],
									"query": [
										{
											"key": "query",
											"value": "id=={{mappingProfileId}}"
										}
									]
								}
							},
							"response": []
						},
						{
							"name": "Get default mapping profile by id",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "e9f758d7-9c6d-454b-9e41-5814cec6d8dc",
										"exec": [
											"pm.test(\"The default mapping profile by id has been retrieved successfully\", () => {\r",
											"    pm.response.to.have.status(200);\r",
											"    pm.response.to.be.withBody;\r",
											"});\r",
											"\r",
											"let mappingProfile = pm.response.json();\r",
											"\r",
											"pm.test(\"With default record type\", () => {\r",
											"    pm.expect(mappingProfile.recordTypes[0]).equal(\"INSTANCE\");\r",
											"});\r",
											"\r",
											"pm.test(\"With default name\", () => {\r",
											"    pm.expect(mappingProfile.name).equal(\"Default instance mapping profile\");\r",
											"});\r",
											"\r",
											"pm.test(\"With default description\", () => {\r",
											"    pm.expect(mappingProfile.description).equal(\"Default mapping profile for the inventory instance record\");\r",
											"});\r",
											"\r",
											"pm.test(\"With default output format\", () => {\r",
											"    pm.expect(mappingProfile.outputFormat).equal(\"MARC\");\r",
											"});\r",
											"\r",
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "83dc770d-177c-489f-afce-34c8637a3a71",
										"exec": [
											"pm.environment.set(\"defaultMappingProfile\", globals.testData.defaultMappingProfileId);\r",
											""
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"name": "Content-Type",
										"type": "text",
										"value": "application/json"
									},
									{
										"key": "x-okapi-token",
										"type": "text",
										"value": "{{xokapitoken}}"
									}
								],
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/mapping-profiles/{{defaultMappingProfile}}",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"data-export",
										"mapping-profiles",
										"{{defaultMappingProfile}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Post jobProfiles",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "a4fca5c7-1b62-4c25-ad5d-6df96a30c26c",
										"exec": [
											"",
											"pm.test(\"Job profile has been created\", () => {",
											"    pm.response.to.have.status(201);",
											"    pm.response.to.be.withBody;",
											"});",
											"",
											"let regularUser = globals.testData.users.regular.user;",
											"let jobProfile = pm.response.json();",
											"",
											"pm.test(\"Verify id exists\", () => {",
											"    pm.expect(jobProfile.id).not.equal(null);",
											"});",
											"",
											"pm.test(\"Verify name exists\", () => {",
											"    pm.expect(jobProfile.name).not.equal(null);",
											"});",
											"",
											"pm.test(\"With userInfo exist\", () => {",
											"    pm.expect(jobProfile.userInfo).not.equal(null);",
											"});",
											"",
											"pm.test(\"With valid firstName\", () => {",
											"    pm.expect(jobProfile.userInfo.firstName).equal(regularUser.personal.firstName);",
											"});",
											"",
											"pm.test(\"With valid lastName\", () => {",
											"    pm.expect(jobProfile.userInfo.lastName).equal(regularUser.personal.lastName);",
											"});",
											"",
											"pm.test(\"With valid userName\", () => {",
											"    pm.expect(jobProfile.userInfo.userName).equal(regularUser.username);",
											"});",
											"",
											"",
											"pm.variables.set(\"jobProfile\", jobProfile);",
											"pm.environment.set(\"jobProfileId\", jobProfile.id);",
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "68cfe356-7d5e-45af-8237-a603a28176b0",
										"exec": [
											"let utils = eval(globals.loadUtils);",
											"",
											"var mappingProfileId = pm.variables.get(\"mappingProfile\").id;",
											"pm.variables.set(\"jobProfile\", JSON.stringify(utils.buildJobProfile(mappingProfileId)));"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "content-type",
										"value": "application/json"
									},
									{
										"key": "x-okapi-token",
										"value": "{{xokapitoken}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{jobProfile}}"
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/job-profiles",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"data-export",
										"job-profiles"
									]
								}
							},
							"response": []
						},
						{
							"name": "Update jobProfile",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "f771c28c-57a3-49d4-a60f-1762c301029d",
										"exec": [
											"pm.test(\"Job profile has been updated\", () => {",
											"    pm.response.to.have.status(204);",
											"});",
											"",
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "0947a2f8-76d2-417a-baff-b4205dbf884e",
										"exec": [
											"let jobProfile = pm.variables.get(\"jobProfile\");",
											"jobProfile.description = \"updated API Test job Profile Description\";",
											"pm.variables.set(\"jobProfile\",  JSON.stringify(jobProfile));"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "PUT",
								"header": [
									{
										"key": "content-type",
										"value": "application/json"
									},
									{
										"key": "x-okapi-token",
										"value": "{{xokapitoken}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{jobProfile}}"
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/job-profiles/{{jobProfileId}}",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"data-export",
										"job-profiles",
										"{{jobProfileId}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Get job profile by id",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "c1001eca-a681-4f98-991d-0aa257c1fd2f",
										"exec": [
											"pm.test(\"The job profile by id has been retrieved successfully\", () => {\r",
											"    pm.response.to.have.status(200);\r",
											"    pm.response.to.be.withBody;\r",
											"});\r",
											"\r",
											"let jobProfile = pm.response.json();\r",
											"\r",
											"pm.test(\"Verify Description has been updated\", () => {\r",
											"    pm.expect(jobProfile.description).equal(\"updated API Test job Profile Description\");\r",
											"});\r",
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "947b8190-2ead-44bf-9ebb-8c01f6105553",
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"name": "Content-Type",
										"type": "text",
										"value": "application/json"
									},
									{
										"key": "x-okapi-token",
										"type": "text",
										"value": "{{xokapitoken}}"
									}
								],
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/job-profiles/{{jobProfileId}}",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"data-export",
										"job-profiles",
										"{{jobProfileId}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Get default job profile by id",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "fea9dd8b-d540-4b81-a571-1d146c18c3b2",
										"exec": [
											"pm.test(\"The default job profile by id has been retrieved successfully\", () => {\r",
											"    pm.response.to.have.status(200);\r",
											"    pm.response.to.be.withBody;\r",
											"});\r",
											"\r",
											"let jobProfile = pm.response.json();\r",
											"\r",
											"pm.test(\"With default name\", () => {\r",
											"    pm.expect(jobProfile.name).equal(\"Default job profile\");\r",
											"});\r",
											"\r",
											"pm.test(\"With default description\", () => {\r",
											"    pm.expect(jobProfile.description).equal(\"Default job profile\");\r",
											"});\r",
											"\r",
											"pm.test(\"With default mappingProfile\", () => {\r",
											"    pm.expect(jobProfile.mappingProfileId).equal(globals.testData.defaultMappingProfileId);\r",
											"});\r",
											"\r",
											"pm.environment.set(\"defaultJobProfile\", JSON.stringify(jobProfile));"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "17f364a5-37f6-48ed-95f4-fab84ff76f0f",
										"exec": [
											"pm.environment.set(\"defaultJobProfileId\", globals.testData.defaultJobProfileId);\r",
											""
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"name": "Content-Type",
										"type": "text",
										"value": "application/json"
									},
									{
										"key": "x-okapi-token",
										"type": "text",
										"value": "{{xokapitoken}}"
									}
								],
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/job-profiles/{{defaultJobProfileId}}",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"data-export",
										"job-profiles",
										"{{defaultJobProfileId}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Update default jobProfile",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "017ddf04-8853-47c1-bba6-f0b363b0b353",
										"exec": [
											"pm.test(\"Verify status when update the default job profile\", () => {",
											"    pm.response.to.have.status(403);",
											"});",
											"",
											"pm.test(\"Verify error message when update the default job profile\", () => {",
											"    let errorMessage = String.fromCharCode.apply(String, new Uint8Array(pm.response.stream));",
											"    pm.expect(errorMessage).equal(\"Editing of default job profile is forbidden\");",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "826f3439-52b9-4208-a625-b259c2ac4ce4",
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "PUT",
								"header": [
									{
										"key": "content-type",
										"value": "application/json"
									},
									{
										"key": "x-okapi-token",
										"value": "{{xokapitoken}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{defaultJobProfile}}"
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/job-profiles/{{defaultJobProfileId}}",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"data-export",
										"job-profiles",
										"{{defaultJobProfileId}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Update default mappingProfile",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "4eef5d98-b607-43cf-8fd0-b56ab3a644ee",
										"exec": [
											"pm.test(\"Verify status when update the default mapping profile\", () => {",
											"    pm.response.to.have.status(403);",
											"});",
											"",
											"pm.test(\"Verify error message when update the default mapping profile\", () => {",
											"    let errorMessage = String.fromCharCode.apply(String, new Uint8Array(pm.response.stream));",
											"    pm.expect(errorMessage).equal(\"Editing of default mapping profile is forbidden\");",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "bee40b38-b950-4375-99c5-a07ac9a57f62",
										"exec": [
											"let mappingProfile = globals.testData.mappingProfile;",
											"mappingProfile.id = globals.testData.defaultMappingProfileId;",
											"pm.variables.set(\"mappingProfile\",  JSON.stringify(mappingProfile));",
											"pm.environment.set(\"defaultMappingProfileId\", JSON.stringify(globals.testData.defaultMappingProfileId));"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "PUT",
								"header": [
									{
										"key": "content-type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "x-okapi-token",
										"value": "{{xokapitoken}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{mappingProfile}}"
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/mapping-profiles/{{defaultMappingProfileId}}",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"data-export",
										"mapping-profiles",
										"{{defaultMappingProfileId}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Delete default jobProfile",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "0ab1cb06-7404-4a4e-a13d-d4d0101849ab",
										"exec": [
											"pm.test(\"Verify status when delete the default job profile\", () => {",
											"    pm.response.to.have.status(403);",
											"});",
											"",
											"pm.test(\"Verify error message when delete the default job profile\", () => {",
											"    let errorMessage = String.fromCharCode.apply(String, new Uint8Array(pm.response.stream));",
											"    pm.expect(errorMessage).equal(\"Deletion of default job profile is forbidden\");",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "ff8b22f7-2a8e-4b89-ac00-3015d20fa1e3",
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "DELETE",
								"header": [
									{
										"key": "content-type",
										"value": "application/json"
									},
									{
										"key": "x-okapi-token",
										"value": "{{xokapitoken}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {}
									}
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/job-profiles/{{defaultJobProfileId}}",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"data-export",
										"job-profiles",
										"{{defaultJobProfileId}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Delete default mappingProfile",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "7a9e4832-d297-463b-9b0e-3a9d82103c87",
										"exec": [
											"pm.test(\"Verify status when delete the default mapping profile\", () => {",
											"    pm.response.to.have.status(403);",
											"});",
											"",
											"pm.test(\"Verify error message when delete the default mapping profile\", () => {",
											"    let errorMessage = String.fromCharCode.apply(String, new Uint8Array(pm.response.stream));",
											"    pm.expect(errorMessage).equal(\"Deletion of default mapping profile is forbidden\");",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "ea6daab5-dc9b-46c8-93ba-d59612e77a76",
										"exec": [
											"pm.variables.set(\"defaultMappingProfileId\", globals.testData.defaultMappingProfileId);"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "DELETE",
								"header": [
									{
										"key": "content-type",
										"type": "text",
										"value": "application/json"
									},
									{
										"key": "x-okapi-token",
										"type": "text",
										"value": "{{xokapitoken}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {}
									}
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/mapping-profiles/{{defaultMappingProfileId}}",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"data-export",
										"mapping-profiles",
										"{{defaultMappingProfileId}}"
									]
								}
							},
							"response": []
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				},
				{
					"name": "Post file definition with invalid filename extension",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "1bb03af6-8345-41c6-a33b-beb2cb0e0d48",
								"exec": [
									"let fileName = JSON.stringify(globals.testData.fileDefinitions.invalidFileDefinition.fileName);",
									"pm.test(\"File difinition with fileName \\\"\"+fileName+\"\\\" has been created\", () => {",
									"    pm.response.to.have.status(422);",
									"    pm.response.to.be.withBody;",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "e43b73d1-1348-44af-8dcc-b19881810443",
								"exec": [
									"pm.variables.set(\"fileDefinition\", JSON.stringify(globals.testData.fileDefinitions.invalidFileDefinition));"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "content-type",
								"value": "application/json"
							},
							{
								"key": "x-okapi-token",
								"value": "{{xokapitoken}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{{fileDefinition}}",
							"options": {
								"raw": {}
							}
						},
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/file-definitions",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"data-export",
								"file-definitions"
							]
						}
					},
					"response": []
				},
				{
					"name": "Post file definition",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "8682a6b8-5858-446c-ae17-0b8af8d1be0c",
								"exec": [
									"let fileName = JSON.stringify(globals.testData.fileDefinitions.validFileDefinition.fileName);",
									"pm.test(\"File difinition with fileName \\\"\"+fileName+\"\\\" has been created\", () => {",
									"    pm.response.to.have.status(201);",
									"    pm.response.to.be.withBody;",
									"});",
									"",
									"let fileDefinition = pm.response.json();",
									"pm.globals.set(\"fileDefinitionId\", fileDefinition.id);"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "04db2c25-9e52-45d7-90f0-1b06d45d494f",
								"exec": [
									"pm.variables.set(\"fileDefinition\", JSON.stringify(globals.testData.fileDefinitions.validFileDefinition));"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "content-type",
								"value": "application/json"
							},
							{
								"key": "x-okapi-token",
								"value": "{{xokapitoken}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{{fileDefinition}}",
							"options": {
								"raw": {}
							}
						},
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/file-definitions",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"data-export",
								"file-definitions"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get file definition by id",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "8eeaab53-b239-43f9-99f6-e9dd6a66d99a",
								"exec": [
									"let fileName = JSON.stringify(globals.testData.fileDefinitions.validFileDefinition.fileName);",
									"pm.test(\"File definition with fileName \"+fileName+ \" has been retrieved successfully\", () => {",
									"    pm.response.to.have.status(200);",
									"    pm.response.to.be.withBody;",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "8604832c-c282-434c-ae5e-73e3f4c3fe71",
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "content-type",
								"value": "application/json"
							},
							{
								"key": "x-okapi-token",
								"value": "{{xokapitoken}}"
							}
						],
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/file-definitions/{{fileDefinitionId}}",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"data-export",
								"file-definitions",
								"{{fileDefinitionId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Post uploading a file",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "132cf051-5520-43fc-8137-43cc6570a684",
								"exec": [
									"let fileName = JSON.stringify(globals.testData.fileDefinitions.validFileDefinition.fileName);",
									"pm.test(\"File has been uplouaded sucessfully\", () => {",
									"    pm.response.to.have.status(200);",
									"    pm.response.to.be.withBody;",
									"});",
									"",
									"let fileDefinition = pm.response.json();",
									"",
									"pm.test(\"Directory for uploaded file has been created & source path not empty\", () => {",
									"    pm.expect(fileDefinition.sourcePath).not.equal(null);",
									"})",
									"",
									"pm.test(\"Status has completed value\", () => {",
									"    pm.expect(fileDefinition.status).equal(\"COMPLETED\");",
									"})",
									"",
									"pm.test(\"With metadata\", () => {",
									"    pm.expect(fileDefinition.metadata).not.equal(null);",
									"})",
									"",
									"pm.variables.set(\"jobExecutionId\", fileDefinition.jobExecutionId);"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "eaec509d-e2fc-4504-a1af-8380af63ecfe",
								"exec": [
									"let utils = eval(globals.loadUtils);\r",
									"pm.sendRequest(pm.variables.get(\"resourcesUrl\") + \"/mockData/test_file_to_upload.csv\", function(err, res) {\r",
									"    let arr = new Uint8Array(res.stream);\r",
									"    let test_file_to_upload = String.fromCharCode.apply(String, arr);",
									"\r",
									"    pm.variables.set(\"fileToUpload\", test_file_to_upload);\r",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/octet-stream"
							},
							{
								"key": "x-okapi-token",
								"value": "{{xokapitoken}}"
							},
							{
								"key": "Content-Disposition",
								"value": "attachment"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{{fileToUpload}}",
							"options": {
								"raw": {}
							}
						},
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/file-definitions/{{fileDefinitionId}}/upload",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"data-export",
								"file-definitions",
								"{{fileDefinitionId}}",
								"upload"
							]
						}
					},
					"response": []
				},
				{
					"name": "Post uploading a file - Idempotent",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "94ecd31f-40e8-46db-b594-1194812cffae",
								"exec": [
									"pm.test(\"File is already uploaded\", () => {",
									"    pm.response.to.have.status(400);",
									"    pm.response.to.be.withBody;",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "55aa32f0-fe15-4a22-a67c-a40ceba65651",
								"exec": [
									"let utils = eval(globals.loadUtils);\r",
									"pm.sendRequest(pm.variables.get(\"resourcesUrl\") + \"/mockData/test_file_to_upload.csv\", function(err, res) {\r",
									"    let test_file_to_upload = res.body;\r",
									"    pm.variables.set(\"fileToUpload\", test_file_to_upload);\r",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/octet-stream"
							},
							{
								"key": "x-okapi-token",
								"value": "{{xokapitoken}}"
							},
							{
								"key": "Content-Disposition",
								"value": "attachment"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{{fileToUpload}}",
							"options": {
								"raw": {}
							}
						},
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/file-definitions/{{fileDefinitionId}}/upload",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"data-export",
								"file-definitions",
								"{{fileDefinitionId}}",
								"upload"
							]
						}
					},
					"response": []
				},
				{
					"name": "Export uploaded file with invalid job profile",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "01bea6ad-c6e9-44cf-8b49-5655f3dfbc6f",
								"exec": [
									"pm.test(\"Export of uploaded file failed with 400 status code\", () => {\r",
									"    pm.response.to.have.status(400);\r",
									"});\r",
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "ab548cc7-0e14-46a3-9d11-71d62f5aebe0",
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "x-okapi-token",
								"type": "text",
								"value": "{{xokapitoken}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"fileDefinitionId\": \"{{fileDefinitionId}}\",\n  \"jobProfileId\": \"da0ccaa8-6f59-11ea-bc55-0242ac130003\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/export",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"data-export",
								"export"
							]
						}
					},
					"response": []
				},
				{
					"name": "Export uploaded with invalid fileDefinitionid",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "aeb48c02-879d-46de-8589-3e970aabe1b2",
								"exec": [
									"pm.test(\"Export of uploaded file failed with 400 status code\", () => {\r",
									"    pm.response.to.have.status(400);\r",
									"});\r",
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "6f7e4726-5ca5-4df4-8a9d-c58b0ee73420",
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "x-okapi-token",
								"type": "text",
								"value": "{{xokapitoken}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"fileDefinitionId\": \"f13c422e-b14b-11ea-b3de-0242ac130004\",\n  \"jobProfileId\": \"{{jobProfileId}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/export",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"data-export",
								"export"
							]
						}
					},
					"response": []
				},
				{
					"name": "Export uploaded file",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "798c663a-d7a0-490f-882f-1ba91c062ce8",
								"exec": [
									"pm.test(\"Export of uploaded file completed successfully\", () => {\r",
									"    pm.response.to.have.status(204);\r",
									"    // The export process has begun. Wait 10 seconds for it to complete.\r",
									"    setTimeout(() => postman.setNextRequest(), 10000);\r",
									"});\r"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "f9b0c97e-cdec-4307-a031-3d32f239e4aa",
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "x-okapi-token",
								"type": "text",
								"value": "{{xokapitoken}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"fileDefinitionId\": \"{{fileDefinitionId}}\",\n  \"jobProfileId\": \"{{jobProfileId}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/export",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"data-export",
								"export"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get job execution",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "43401a87-37f0-4e0d-8bee-69a986c32fec",
								"exec": [
									"pm.test(\"Job execution has been retrieved successfully\", () => {",
									"    pm.response.to.have.status(200);",
									"    pm.response.to.be.withBody;",
									"});",
									"",
									"let jobExecution = pm.response.json().jobExecutions.find(job => job.id === pm.variables.get(\"jobExecutionId\"));",
									"var jobProfile = JSON.parse(pm.variables.get(\"jobProfile\"));",
									"",
									"pm.test(\"The status is completed with errors\", () => {",
									"    pm.expect(jobExecution.status).equal(\"COMPLETED_WITH_ERRORS\");",
									"});",
									"",
									"pm.test(\"File name contains hrId\", () => {",
									"    pm.expect(jobExecution.exportedFiles[0].fileName).include(jobExecution.hrId);",
									"});",
									"",
									"pm.test(\"With runBy object\", () => {",
									"    pm.expect(jobExecution.runBy).not.equal(null);",
									"});",
									"",
									"pm.test(\"With progress\", () => {",
									"    pm.expect(jobExecution.progress).not.equal(null);",
									"});",
									"",
									"pm.test(\"With progress exported equal to 1\", () => {",
									"    pm.expect(jobExecution.progress.exported).equal(1);",
									"});",
									"",
									"pm.test(\"With progress failed equal to 4\", () => {",
									"    pm.expect(jobExecution.progress.failed).equal(4);",
									"});",
									"",
									"pm.test(\"With progress total equals to 5\", () => {",
									"    pm.expect(jobExecution.progress.total).equal(5);",
									"});",
									"",
									"pm.test(\"With correct jobProfileName\", () => {",
									"    pm.expect(jobExecution.jobProfileId).equal(jobProfile.id);",
									"});",
									"",
									"pm.test(\"With correct jobProfileId\", () => {",
									"    pm.expect(jobExecution.jobProfileName).equal(jobProfile.name);",
									"});",
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "b6fe5cfe-359d-4033-95e7-9e64b5b18ac7",
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "x-okapi-token",
								"type": "text",
								"value": "{{xokapitoken}}"
							}
						],
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/job-executions?query=id={{jobExecutionId}}",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"data-export",
								"job-executions"
							],
							"query": [
								{
									"key": "query",
									"value": "id={{jobExecutionId}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Get error logs",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "89f69656-959c-4f56-90e1-08944e4e135a",
								"exec": [
									"pm.test(\"Error logs has been retrieved successfully\", () => {",
									"    pm.response.to.have.status(200);",
									"    pm.response.to.be.withBody;",
									"});",
									"",
									"let errorLogs = pm.response.json().errorLogs;",
									"",
									"pm.test(\"The erorr logs is present as 4 UUIDs should not be found in SRS and inventory\", () => {",
									"    let jsonData = pm.response.json()",
									"    pm.expect(errorLogs).to.be.an(\"array\");",
									"    pm.expect(errorLogs).not.equal(0);",
									"});",
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "2a8b748c-0daf-404f-a820-869a5e64fa63",
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							},
							{
								"key": "x-okapi-token",
								"type": "text",
								"value": "{{xokapitoken}}"
							}
						],
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/logs?query=jobExecutionId={{jobExecutionId}}",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"data-export",
								"logs"
							],
							"query": [
								{
									"key": "query",
									"value": "jobExecutionId={{jobExecutionId}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Get transformation fields",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "8a65a820-0ba2-47fb-a2de-d223282aaa54",
								"exec": [
									"pm.test(\"Transformation fields has been retrieved successfully\", () => {",
									"    pm.response.to.have.status(200);",
									"    pm.response.to.be.withBody;",
									"});",
									"",
									"pm.test(\"Transformation fields array is not empty\", () => {",
									"    let jsonData = pm.response.json()",
									"    pm.expect(jsonData.transformationFields).to.be.an(\"array\");",
									"    pm.expect(jsonData.transformationFields.length).not.equal(0);",
									"});",
									"",
									"pm.test(\"And totalRecords is present\", () => {",
									"    pm.expect(pm.response.json()).to.have.property('totalRecords');",
									"});",
									"",
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "5880e90c-3e4e-403b-8370-5f2e3c4fde88",
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							},
							{
								"key": "x-okapi-token",
								"type": "text",
								"value": "{{xokapitoken}}"
							}
						],
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/transformation-fields",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"data-export",
								"transformation-fields"
							]
						}
					},
					"response": []
				},
				{
					"name": "Post expire job executions",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "e1454e86-b3f0-4893-b976-965f24bd07eb",
								"exec": [
									"pm.test(\"Expire job execution return 204 status\", () => {\r",
									"    pm.response.to.have.status(204);\r",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "x-okapi-token",
								"value": "{{xokapitoken}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/expire-jobs",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"data-export",
								"expire-jobs"
							]
						}
					},
					"response": []
				},
				{
					"name": "Post expire job executions Copy",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "af4ba1af-aa00-4adf-9b6c-8b73b9a5911f",
								"exec": [
									"pm.test(\"Clean up file definitions return 204 status\", () => {\r",
									"    pm.response.to.have.status(204);\r",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "x-okapi-token",
								"value": "{{xokapitoken}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/clean-up-files",
							"protocol": "{{protocol}}",
							"host": [
								"{{url}}"
							],
							"port": "{{okapiport}}",
							"path": [
								"data-export",
								"clean-up-files"
							]
						}
					},
					"response": []
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "e2e4d1e8-da5a-4c20-92e3-e58cf7392907",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "1032d15b-b73a-4798-adda-f256f2fdee90",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			],
			"protocolProfileBehavior": {}
		},
		{
			"name": "Cleanup",
			"item": [
				{
					"name": "Profiles",
					"item": [
						{
							"name": "Delete jobProfile",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "4420cf77-eff9-491d-a049-64dcb7d2f5fc",
										"exec": [
											"pm.test(\"Job profile assosiated with job execution cannot be deleted\", () => {",
											"    pm.response.to.have.status(422);",
											"});",
											"",
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "521c2076-4e7c-4d27-82e9-90336271d636",
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "DELETE",
								"header": [
									{
										"key": "content-type",
										"value": "application/json"
									},
									{
										"key": "x-okapi-token",
										"value": "{{xokapitoken}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {}
									}
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/data-export/job-profiles/{{jobProfileId}}",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"data-export",
										"job-profiles",
										"{{jobProfileId}}"
									]
								}
							},
							"response": []
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				},
				{
					"name": "clean tenant and modules data",
					"item": [
						{
							"name": "Get modules to disable for tenant",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"id": "60bb8bcb-d174-46da-aad2-0a410a6c1837",
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"id": "0b88dcff-8db8-48b5-aad3-5ba1546efeaf",
										"exec": [
											"\r",
											"    let modulesToDisable = pm.response.json();\r",
											"    modulesToDisable.forEach(entry => entry.action = \"disable\");\r",
											"    pm.environment.set(\"modulesToDisable\", JSON.stringify(modulesToDisable));"
										],
										"type": "text/javascript"
									}
								}
							],
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"type": "text",
										"value": "application/json"
									},
									{
										"key": "X-Okapi-Token",
										"value": "{{xokapitoken-admin}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{modulesToDisable}}",
									"options": {
										"raw": {}
									}
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/_/proxy/tenants/{{testTenant}}/modules",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"_",
										"proxy",
										"tenants",
										"{{testTenant}}",
										"modules"
									]
								}
							},
							"response": []
						},
						{
							"name": "Purge and disable all module for created tenant",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"id": "4fd6ab3c-327c-45e5-804e-dbfe89152ffe",
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"id": "e50f8275-368d-413a-bae6-274d52fb6439",
										"exec": [
											"let utils = eval(globals.loadUtils);\r",
											"pm.test(\"Disable all modules for test tenant\", function() {\r",
											"    pm.response.to.have.status(200);\r",
											"    pm.response.to.be.withBody;\r",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"type": "text",
										"value": "application/json"
									},
									{
										"key": "X-Okapi-Token",
										"value": "{{xokapitoken-admin}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{{modulesToDisable}}",
									"options": {
										"raw": {}
									}
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/_/proxy/tenants/{{testTenant}}/install?purge=true",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"_",
										"proxy",
										"tenants",
										"{{testTenant}}",
										"install"
									],
									"query": [
										{
											"key": "purge",
											"value": "true"
										}
									]
								}
							},
							"response": []
						},
						{
							"name": "Delete test tenant",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"id": "75444026-f510-4fdc-9b69-a8a9ef1d6be1",
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"id": "f62930a7-d633-432d-bb4a-1933de91aaea",
										"exec": [
											"pm.test(\"Tenant deleted - Expected Created (204)\", () => {\r",
											"    pm.response.to.have.status(204);\r",
											"});\r",
											"\r",
											"// Remove all created variables\r",
											"eval(globals.loadUtils).unsetTestVariables();"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "DELETE",
								"header": [
									{
										"key": "x-okapi-token",
										"value": "{{xokapitoken-admin}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {}
									}
								},
								"url": {
									"raw": "{{protocol}}://{{url}}:{{okapiport}}/_/proxy/tenants/{{testTenant}}",
									"protocol": "{{protocol}}",
									"host": [
										"{{url}}"
									],
									"port": "{{okapiport}}",
									"path": [
										"_",
										"proxy",
										"tenants",
										"{{testTenant}}"
									]
								}
							},
							"response": []
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "3d5fc072-4607-4fa2-abf7-97d50954f504",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "1525bf36-54f6-4b4d-aea6-0b58d01f3e2b",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			],
			"protocolProfileBehavior": {}
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"id": "2949fe2a-aec8-4d88-8d1f-ccf7489fcbfb",
				"type": "text/javascript",
				"exec": [
					"let testData = {",
					"    // User template with hardcoded id",
					"    users: {",
					"        admin: {",
					"            user: {",
					"                \"id\": \"00000000-1111-5555-9999-999999999999\",",
					"                \"username\": \"mdexp-admin-user\",",
					"                \"active\": true,",
					"                \"personal\": {",
					"                    \"firstName\": \"Test\",",
					"                    \"lastName\": \"Api\"",
					"                }",
					"            },",
					"            credentials: {",
					"                \"username\": \"mdexp-admin-user\",",
					"                \"password\": \"mdexp-admin-password\"",
					"            },",
					"            permissions: {",
					"                \"userId\": \"00000000-1111-5555-9999-999999999999\",",
					"                \"permissions\": []",
					"            }",
					"        },",
					"        regular: {",
					"            user: {",
					"                \"id\": \"00000001-1111-5555-9999-999999999999\",",
					"                \"username\": \"mdexp-user\",",
					"                \"active\": true,",
					"                \"personal\": {",
					"                    \"firstName\": \"Regular\",",
					"                    \"lastName\": \"API Tests\"",
					"                }",
					"            },",
					"            credentials: {",
					"                \"username\": \"mdexp-user\",",
					"                \"password\": \"mdexp-password\"",
					"            },",
					"            permissions: {",
					"                \"userId\": \"00000001-1111-5555-9999-999999999999\",",
					"                \"permissions\": [",
					"                    \"data-export.export.post\",",
					"                    \"data-export.file-definitions.item.get\",",
					"                    \"data-export.file-definitions.item.post\",",
					"                    \"data-export.file-definitions.upload.post\",",
					"                    \"data-export.job-executions.items.get\",",
					"                    \"data-export.mapping-profiles.item.post\",",
					"                    \"data-export.mapping-profiles.collection.get\",",
					"                    \"data-export.mapping-profiles.item.get\",",
					"                    \"data-export.mapping-profiles.item.put\",",
					"                    \"data-export.mapping-profiles.item.delete\",",
					"                    \"data-export.job-profiles.item.post\",",
					"                    \"data-export.job-profiles.collection.get\",",
					"                    \"data-export.job-profiles.item.get\",",
					"                    \"data-export.job-profiles.item.put\",",
					"                    \"data-export.job-profiles.item.delete\",",
					"                    \"data-export.transformation-fields.collection.get\",",
					"                    \"data-export.expire-jobs.post\",",
					"                    \"data-export.logs.collection.get\",",
					"                    \"data-export.clean-up-files.post\"",
					"                ]",
					"            }",
					"        },",
					"    },",
					"    tenant: {",
					"        \"id\": pm.variables.get(\"testTenant\"),",
					"        \"name\": \"Test mod-data-export tenant\",",
					"        \"description\": \"Tenant for test purpose\"",
					"    },",
					"    fileDefinitions: {",
					"        validFileDefinition: {",
					"            \"fileName\": \"test_file.csv\",",
					"            \"uploadFormat\": \"csv\"",
					"        },",
					"        invalidFileDefinition: {",
					"            \"fileName\": \"test_file.txt\"",
					"        }",
					"    },",
					"    mappingProfile: {",
					"        \"id\": \"06402561-c5e8-4915-bc5a-684043fcc10a\",",
					"        \"name\": \"Mapping profile\",",
					"        \"description\": \"Mapping profile description\",",
					"        \"recordTypes\": [",
					"            \"INSTANCE\",",
					"            \"HOLDINGS\", ",
					"            \"ITEM\"",
					"        ],",
					"        \"outputFormat\": \"MARC\",",
					"        \"transformations\": [",
					"            {",
					"                \"fieldId\": \"holdings.callnumber\",",
					"                \"path\": \"$.holdings[*].callNumber\",",
					"                \"recordType\": \"HOLDINGS\",",
					"                \"transformation\": \"900  $a\",",
					"                \"enabled\": true",
					"            },",
					"            {",
					"                \"fieldId\": \"instance.hrid\",",
					"                \"path\": \"$.instance.hrid\",",
					"                \"recordType\": \"INSTANCE\",",
					"                \"transformation\": \"901ff$a\",",
					"                \"enabled\": true",
					"            },",
					"            {",
					"                \"fieldId\": \"item.copynumber\",",
					"                \"path\": \"$.holdings[*].items[*].copyNumber\",",
					"                \"recordType\": \"ITEM\",",
					"                \"transformation\": \"902 1$a\",",
					"                \"enabled\": true",
					"            }",
					"        ]",
					"    },",
					"    defaultMappingProfileId: \"25d81cbe-9686-11ea-bb37-0242ac130002\",",
					"    defaultJobProfileId: \"6f7f3cd7-9f24-42eb-ae91-91af1cd54d0a\"",
					"};",
					"",
					"// Global testing object - used in further tests",
					"pm.globals.set(\"testData\", testData);",
					"",
					"postman.setGlobalVariable(\"loadUtils\", function loadUtils() {",
					"    let utils = {};",
					"",
					"    utils.buildOkapiURL = function (path) {",
					"        return pm.environment.get(\"protocol\") + \"://\" + pm.environment.get(\"url\") + \":\" + pm.environment.get(\"okapiport\") + path;",
					"    };",
					"",
					"    utils.getModuleId = function (moduleName, bodyHandler) {",
					"        pm.sendRequest({",
					"            url: utils.buildOkapiURL(\"/_/proxy/modules?latest=1&filter=\" + moduleName),",
					"            method: \"GET\",",
					"            header: {",
					"                \"X-Okapi-Token\": pm.environment.get(\"xokapitoken-admin\")",
					"            }",
					"        }, (err, res) => {",
					"            pm.test(moduleName + \" module is available\", () => {",
					"                pm.expect(err).to.equal(null);",
					"                pm.expect(res.code).to.equal(200);",
					"                bodyHandler(res.json()[0].id);",
					"            });",
					"        });",
					"    };",
					"",
					"    /**",
					"    * Build Job Profile with mappingProfileId.",
					"    */",
					"    utils.buildJobProfile = function (mappingProfileId) {",
					"        return {",
					"            \"name\": \"APITest-JobProfile\",",
					"            \"destination\": \"fileSystem\",",
					"            \"description\": \"Job profile for API tests\",",
					"            \"mappingProfileId\": mappingProfileId",
					"        };",
					"    };",
					"",
					"    /**",
					"     * Clean up variables",
					"     */",
					"    utils.unsetTestVariables = function () {",
					"        pm.globals.unset(\"loadUtils\");",
					"        pm.globals.unset(\"testData\");",
					"        pm.globals.unset(\"fileDefinitionId\");",
					"        pm.environment.unset(\"defaultJobProfile\");",
					"        pm.environment.unset(\"jobProfileId\");",
					"        pm.environment.unset(\"mappingProfileId\");",
					"        pm.environment.unset(\"xokapitoken\");",
					"        pm.environment.unset(\"xokapitoken-admin\");",
					"        pm.environment.unset(\"xokapitoken-testAdmin\");",
					"        pm.environment.unset(\"modulesToDisable\");",
					"    };",
					"    return utils;",
					"} + '; loadUtils();');"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"id": "cfd1017f-d844-4a9c-91f9-1e3af01b6859",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"id": "82b1cd8e-36e6-4b7e-b883-bd0b8615ff42",
			"key": "testTenant",
			"value": "mdexp_test_tenant"
		},
		{
			"id": "21d2a75f-cbc2-47f3-8762-f3fb8fd2b8dd",
			"key": "xokapitenant",
			"value": "diku"
		},
		{
			"id": "d783badd-e239-48f4-b296-a72f4b823ed3",
			"key": "protocol",
			"value": "http"
		},
		{
			"id": "7e659789-65b9-4cde-b944-3b0b0e32d41b",
			"key": "url",
			"value": "localhost"
		},
		{
			"id": "9488a2c6-4902-4149-810e-9a549cb75cf5",
			"key": "okapiport",
			"value": "9130"
		},
		{
			"id": "3d1e1c72-6ce0-445d-bbd3-ee5796f08a39",
			"key": "resourcesUrl",
			"value": "https://raw.githubusercontent.com/folio-org/mod-data-export/master/src/test/resources"
		}
	],
	"protocolProfileBehavior": {}
}
